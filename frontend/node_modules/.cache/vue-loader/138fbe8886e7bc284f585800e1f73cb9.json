{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lq/ifb/src/eshop/frontend/src/components/prompts/Share.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/components/prompts/Share.vue","mtime":1583132470976},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlLCBtYXBHZXR0ZXJzIH0gZnJvbSAndnVleCcKaW1wb3J0IHsgc2hhcmUgYXMgYXBpIH0gZnJvbSAnQC9hcGknCmltcG9ydCB7IGJhc2VVUkwgfSBmcm9tICdAL3V0aWxzL2NvbnN0YW50cycKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnCmltcG9ydCBDbGlwYm9hcmQgZnJvbSAnY2xpcGJvYXJkJwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdzaGFyZScsCiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgdGltZTogJycsCiAgICAgIHVuaXQ6ICdob3VycycsCiAgICAgIGhhc1Blcm1hbmVudDogZmFsc2UsCiAgICAgIGxpbmtzOiBbXSwKICAgICAgY2xpcDogbnVsbAogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKFsgJ3JlcScsICdzZWxlY3RlZCcsICdzZWxlY3RlZENvdW50JyBdKSwKICAgIC4uLm1hcEdldHRlcnMoWyAnaXNMaXN0aW5nJyBdKSwKICAgIHVybCAoKSB7CiAgICAgIGlmICghdGhpcy5pc0xpc3RpbmcpIHsKICAgICAgICByZXR1cm4gdGhpcy4kcm91dGUucGF0aAogICAgICB9CgogICAgICBpZiAodGhpcy5zZWxlY3RlZENvdW50ID09PSAwIHx8IHRoaXMuc2VsZWN0ZWRDb3VudCA+IDEpIHsKICAgICAgICAvLyBUaGlzIHNob3VsZG4ndCBoYXBwZW4uCiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLnJlcS5pdGVtc1t0aGlzLnNlbGVjdGVkWzBdXS51cmwKICAgIH0KICB9LAogIGFzeW5jIGJlZm9yZU1vdW50ICgpIHsKICAgIHRyeSB7CiAgICAgIGNvbnN0IGxpbmtzID0gYXdhaXQgYXBpLmdldCh0aGlzLnVybCkKICAgICAgdGhpcy5saW5rcyA9IGxpbmtzCiAgICAgIHRoaXMuc29ydCgpCgogICAgICBmb3IgKGxldCBsaW5rIG9mIHRoaXMubGlua3MpIHsKICAgICAgICBpZiAobGluay5leHBpcmUgPT09IDApIHsKICAgICAgICAgIHRoaXMuaGFzUGVybWFuZW50ID0gdHJ1ZQogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdGhpcy4kc2hvd0Vycm9yKGUpCiAgICB9CiAgfSwKICBtb3VudGVkICgpIHsKICAgIHRoaXMuY2xpcCA9IG5ldyBDbGlwYm9hcmQoJy5jb3B5LWNsaXBib2FyZCcpCiAgICB0aGlzLmNsaXAub24oJ3N1Y2Nlc3MnLCAoKSA9PiB7CiAgICAgIHRoaXMuJHNob3dTdWNjZXNzKHRoaXMuJHQoJ3N1Y2Nlc3MubGlua0NvcGllZCcpKQogICAgfSkKICB9LAogIGJlZm9yZURlc3Ryb3kgKCkgewogICAgdGhpcy5jbGlwLmRlc3Ryb3koKQogIH0sCiAgbWV0aG9kczogewogICAgc3VibWl0OiBhc3luYyBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy50aW1lKSByZXR1cm4KCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgYXBpLmNyZWF0ZSh0aGlzLnVybCwgdGhpcy50aW1lLCB0aGlzLnVuaXQpCiAgICAgICAgdGhpcy5saW5rcy5wdXNoKHJlcykKICAgICAgICB0aGlzLnNvcnQoKQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdGhpcy4kc2hvd0Vycm9yKGUpCiAgICAgIH0KICAgIH0sCiAgICBnZXRQZXJtYWxpbms6IGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBhcGkuY3JlYXRlKHRoaXMudXJsKQogICAgICAgIHRoaXMubGlua3MucHVzaChyZXMpCiAgICAgICAgdGhpcy5zb3J0KCkKICAgICAgICB0aGlzLmhhc1Blcm1hbmVudCA9IHRydWUKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuJHNob3dFcnJvcihlKQogICAgICB9CiAgICB9LAogICAgZGVsZXRlTGluazogYXN5bmMgZnVuY3Rpb24gKGV2ZW50LCBsaW5rKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKICAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgYXBpLnJlbW92ZShsaW5rLmhhc2gpCiAgICAgICAgaWYgKGxpbmsuZXhwaXJlID09PSAwKSB0aGlzLmhhc1Blcm1hbmVudCA9IGZhbHNlCiAgICAgICAgdGhpcy5saW5rcyA9IHRoaXMubGlua3MuZmlsdGVyKGl0ZW0gPT4gaXRlbS5oYXNoICE9PSBsaW5rLmhhc2gpCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aGlzLiRzaG93RXJyb3IoZSkKICAgICAgfQogICAgfSwKICAgIGh1bWFuVGltZSAodGltZSkgewogICAgICByZXR1cm4gbW9tZW50KHRpbWUgKiAxMDAwKS5mcm9tTm93KCkKICAgIH0sCiAgICBidWlsZExpbmsgKGhhc2gpIHsKICAgICAgcmV0dXJuIGAke3dpbmRvdy5sb2NhdGlvbi5vcmlnaW59JHtiYXNlVVJMfS9zaGFyZS8ke2hhc2h9YAogICAgfSwKICAgIHNvcnQgKCkgewogICAgICB0aGlzLmxpbmtzID0gdGhpcy5saW5rcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgaWYgKGEuZXhwaXJlID09PSAwKSByZXR1cm4gLTEKICAgICAgICBpZiAoYi5leHBpcmUgPT09IDApIHJldHVybiAxCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGEuZXhwaXJlKSAtIG5ldyBEYXRlKGIuZXhwaXJlKQogICAgICB9KQogICAgfQogIH0KfQo="},{"version":3,"sources":["Share.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Share.vue","sourceRoot":"src/components/prompts","sourcesContent":["<template>\n  <div class=\"card floating\" id=\"share\">\n    <div class=\"card-title\">\n      <h2>{{ $t('buttons.share') }}</h2>\n    </div>\n\n    <div class=\"card-content\">\n      <ul>\n        <li v-if=\"!hasPermanent\">\n          <a @click=\"getPermalink\" :aria-label=\"$t('buttons.permalink')\">{{ $t('buttons.permalink') }}</a>\n        </li>\n\n        <li v-for=\"link in links\" :key=\"link.hash\">\n          <a :href=\"buildLink(link.hash)\" target=\"_blank\">\n            <template v-if=\"link.expire !== 0\">{{ humanTime(link.expire) }}</template>\n            <template v-else>{{ $t('permanent') }}</template>\n          </a>\n\n          <button class=\"action\"\n            @click=\"deleteLink($event, link)\"\n            :aria-label=\"$t('buttons.delete')\"\n            :title=\"$t('buttons.delete')\"><i class=\"material-icons\">delete</i></button>\n\n          <button class=\"action copy-clipboard\"\n            :data-clipboard-text=\"buildLink(link.hash)\"\n            :aria-label=\"$t('buttons.copyToClipboard')\"\n            :title=\"$t('buttons.copyToClipboard')\"><i class=\"material-icons\">content_paste</i></button>\n        </li>\n\n        <li>\n          <input v-focus\n            type=\"number\"\n            max=\"2147483647\"\n            min=\"0\"\n            @keyup.enter=\"submit\"\n            v-model.trim=\"time\">\n          <select v-model=\"unit\" :aria-label=\"$t('time.unit')\">\n            <option value=\"seconds\">{{ $t('time.seconds') }}</option>\n            <option value=\"minutes\">{{ $t('time.minutes') }}</option>\n            <option value=\"hours\">{{ $t('time.hours') }}</option>\n            <option value=\"days\">{{ $t('time.days') }}</option>\n          </select>\n          <button class=\"action\"\n            @click=\"submit\"\n            :aria-label=\"$t('buttons.create')\"\n            :title=\"$t('buttons.create')\"><i class=\"material-icons\">add</i></button>\n        </li>\n      </ul>\n    </div>\n\n    <div class=\"card-action\">\n      <button class=\"button button--flat\"\n        @click=\"$store.commit('closeHovers')\"\n        :aria-label=\"$t('buttons.close')\"\n        :title=\"$t('buttons.close')\">{{ $t('buttons.close') }}</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters } from 'vuex'\nimport { share as api } from '@/api'\nimport { baseURL } from '@/utils/constants'\nimport moment from 'moment'\nimport Clipboard from 'clipboard'\n\nexport default {\n  name: 'share',\n  data: function () {\n    return {\n      time: '',\n      unit: 'hours',\n      hasPermanent: false,\n      links: [],\n      clip: null\n    }\n  },\n  computed: {\n    ...mapState([ 'req', 'selected', 'selectedCount' ]),\n    ...mapGetters([ 'isListing' ]),\n    url () {\n      if (!this.isListing) {\n        return this.$route.path\n      }\n\n      if (this.selectedCount === 0 || this.selectedCount > 1) {\n        // This shouldn't happen.\n        return\n      }\n\n      return this.req.items[this.selected[0]].url\n    }\n  },\n  async beforeMount () {\n    try {\n      const links = await api.get(this.url)\n      this.links = links\n      this.sort()\n\n      for (let link of this.links) {\n        if (link.expire === 0) {\n          this.hasPermanent = true\n          break\n        }\n      }\n    } catch (e) {\n      this.$showError(e)\n    }\n  },\n  mounted () {\n    this.clip = new Clipboard('.copy-clipboard')\n    this.clip.on('success', () => {\n      this.$showSuccess(this.$t('success.linkCopied'))\n    })\n  },\n  beforeDestroy () {\n    this.clip.destroy()\n  },\n  methods: {\n    submit: async function () {\n      if (!this.time) return\n\n      try {\n        const res = await api.create(this.url, this.time, this.unit)\n        this.links.push(res)\n        this.sort()\n      } catch (e) {\n        this.$showError(e)\n      }\n    },\n    getPermalink: async function () {\n      try {\n        const res = await api.create(this.url)\n        this.links.push(res)\n        this.sort()\n        this.hasPermanent = true\n      } catch (e) {\n        this.$showError(e)\n      }\n    },\n    deleteLink: async function (event, link) {\n      event.preventDefault()\n       try {\n        await api.remove(link.hash)\n        if (link.expire === 0) this.hasPermanent = false\n        this.links = this.links.filter(item => item.hash !== link.hash)\n      } catch (e) {\n        this.$showError(e)\n      }\n    },\n    humanTime (time) {\n      return moment(time * 1000).fromNow()\n    },\n    buildLink (hash) {\n      return `${window.location.origin}${baseURL}/share/${hash}`\n    },\n    sort () {\n      this.links = this.links.sort((a, b) => {\n        if (a.expire === 0) return -1\n        if (b.expire === 0) return 1\n        return new Date(a.expire) - new Date(b.expire)\n      })\n    }\n  }\n}\n</script>\n\n"]}]}