{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lq/ifb/src/eshop/frontend/src/components/files/ListingItem.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/components/files/ListingItem.vue","mtime":1583132470976},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcE11dGF0aW9ucywgbWFwR2V0dGVycywgbWFwU3RhdGUgfSBmcm9tICd2dWV4JwppbXBvcnQgZmlsZXNpemUgZnJvbSAnZmlsZXNpemUnCmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JwppbXBvcnQgeyBmaWxlcyBhcyBhcGkgfSBmcm9tICdAL2FwaScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnaXRlbScsCiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgdG91Y2hlczogMAogICAgfQogIH0sCiAgcHJvcHM6IFsnbmFtZScsICdpc0RpcicsICd1cmwnLCAndHlwZScsICdzaXplJywgJ21vZGlmaWVkJywgJ2luZGV4J10sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKFsnc2VsZWN0ZWQnLCAncmVxJ10pLAogICAgLi4ubWFwR2V0dGVycyhbJ3NlbGVjdGVkQ291bnQnXSksCiAgICBpc1NlbGVjdGVkICgpIHsKICAgICAgcmV0dXJuICh0aGlzLnNlbGVjdGVkLmluZGV4T2YodGhpcy5pbmRleCkgIT09IC0xKQogICAgfSwKICAgIGljb24gKCkgewogICAgICBpZiAodGhpcy5pc0RpcikgcmV0dXJuICdmb2xkZXInCiAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdpbWFnZScpIHJldHVybiAnaW5zZXJ0X3Bob3RvJwogICAgICBpZiAodGhpcy50eXBlID09PSAnYXVkaW8nKSByZXR1cm4gJ3ZvbHVtZV91cCcKICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ3ZpZGVvJykgcmV0dXJuICdtb3ZpZScKICAgICAgcmV0dXJuICdpbnNlcnRfZHJpdmVfZmlsZScKICAgIH0sCiAgICBjYW5Ecm9wICgpIHsKICAgICAgaWYgKCF0aGlzLmlzRGlyKSByZXR1cm4gZmFsc2UKCiAgICAgIGZvciAobGV0IGkgb2YgdGhpcy5zZWxlY3RlZCkgewogICAgICAgIGlmICh0aGlzLnJlcS5pdGVtc1tpXS51cmwgPT09IHRoaXMudXJsKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAuLi5tYXBNdXRhdGlvbnMoWydhZGRTZWxlY3RlZCcsICdyZW1vdmVTZWxlY3RlZCcsICdyZXNldFNlbGVjdGVkJ10pLAogICAgaHVtYW5TaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBmaWxlc2l6ZSh0aGlzLnNpemUpCiAgICB9LAogICAgaHVtYW5UaW1lOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBtb21lbnQodGhpcy5tb2RpZmllZCkuZnJvbU5vdygpCiAgICB9LAogICAgZHJhZ1N0YXJ0OiBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLnNlbGVjdGVkQ291bnQgPT09IDApIHsKICAgICAgICB0aGlzLmFkZFNlbGVjdGVkKHRoaXMuaW5kZXgpCiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5pc1NlbGVjdGVkKSB7CiAgICAgICAgdGhpcy5yZXNldFNlbGVjdGVkKCkKICAgICAgICB0aGlzLmFkZFNlbGVjdGVkKHRoaXMuaW5kZXgpCiAgICAgIH0KICAgIH0sCiAgICBkcmFnT3ZlcjogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIGlmICghdGhpcy5jYW5Ecm9wKSByZXR1cm4KCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKICAgICAgbGV0IGVsID0gZXZlbnQudGFyZ2V0CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgIGlmICghZWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdpdGVtJykpIHsKICAgICAgICAgIGVsID0gZWwucGFyZW50RWxlbWVudAogICAgICAgIH0KICAgICAgfQoKICAgICAgZWwuc3R5bGUub3BhY2l0eSA9IDEKICAgIH0sCiAgICBkcm9wOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgaWYgKCF0aGlzLmNhbkRyb3ApIHJldHVybgogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpCgogICAgICBpZiAodGhpcy5zZWxlY3RlZENvdW50ID09PSAwKSByZXR1cm4KCiAgICAgIGxldCBpdGVtcyA9IFtdCgogICAgICBmb3IgKGxldCBpIG9mIHRoaXMuc2VsZWN0ZWQpIHsKICAgICAgICBpdGVtcy5wdXNoKHsKICAgICAgICAgIGZyb206IHRoaXMucmVxLml0ZW1zW2ldLnVybCwKICAgICAgICAgIHRvOiB0aGlzLnVybCArIHRoaXMucmVxLml0ZW1zW2ldLm5hbWUKICAgICAgICB9KQogICAgICB9CgogICAgICBhcGkubW92ZShpdGVtcykKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFJlbG9hZCcsIHRydWUpCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2godGhpcy4kc2hvd0Vycm9yKQogICAgfSwKICAgIGNsaWNrOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRDb3VudCAhPT0gMCkgZXZlbnQucHJldmVudERlZmF1bHQoKQogICAgICBpZiAodGhpcy4kc3RvcmUuc3RhdGUuc2VsZWN0ZWQuaW5kZXhPZih0aGlzLmluZGV4KSAhPT0gLTEpIHsKICAgICAgICB0aGlzLnJlbW92ZVNlbGVjdGVkKHRoaXMuaW5kZXgpCiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIGlmIChldmVudC5zaGlmdEtleSkgewogICAgICAgIGxldCBmaSA9IDAKICAgICAgICBsZXQgbGEgPSAwCgogICAgICAgIGlmICh0aGlzLmluZGV4ID4gdGhpcy5zZWxlY3RlZFswXSkgewogICAgICAgICAgZmkgPSB0aGlzLnNlbGVjdGVkWzBdICsgMQogICAgICAgICAgbGEgPSB0aGlzLmluZGV4CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZpID0gdGhpcy5pbmRleAogICAgICAgICAgbGEgPSB0aGlzLnNlbGVjdGVkWzBdIC0gMQogICAgICAgIH0KCiAgICAgICAgZm9yICg7IGZpIDw9IGxhOyBmaSsrKSB7CiAgICAgICAgICB0aGlzLmFkZFNlbGVjdGVkKGZpKQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIGlmICghZXZlbnQuY3RybEtleSAmJiAhdGhpcy4kc3RvcmUuc3RhdGUubXVsdGlwbGUpIHRoaXMucmVzZXRTZWxlY3RlZCgpCiAgICAgIHRoaXMuYWRkU2VsZWN0ZWQodGhpcy5pbmRleCkKICAgIH0sCiAgICB0b3VjaHN0YXJ0ICgpIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy50b3VjaGVzID0gMAogICAgICB9LCAzMDApCgogICAgICB0aGlzLnRvdWNoZXMrKwogICAgICBpZiAodGhpcy50b3VjaGVzID4gMSkgewogICAgICAgIHRoaXMub3BlbigpCiAgICAgIH0KICAgIH0sCiAgICBvcGVuOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHtwYXRoOiB0aGlzLnVybH0pCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["ListingItem.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ListingItem.vue","sourceRoot":"src/components/files","sourcesContent":["<template>\n  <div class=\"item\"\n  role=\"button\"\n  tabindex=\"0\"\n  draggable=\"true\"\n  @dragstart=\"dragStart\"\n  @dragover=\"dragOver\"\n  @drop=\"drop\"\n  @click=\"click\"\n  @dblclick=\"open\"\n  @touchstart=\"touchstart\"\n  :data-dir=\"isDir\"\n  :aria-label=\"name\"\n  :aria-selected=\"isSelected\">\n    <div>\n      <i class=\"material-icons\">{{ icon }}</i>\n    </div>\n\n    <div>\n      <p class=\"name\">{{ name }}</p>\n\n      <p v-if=\"isDir\" class=\"size\" data-order=\"-1\">&mdash;</p>\n      <p v-else class=\"size\" :data-order=\"humanSize()\">{{ humanSize() }}</p>\n\n      <p class=\"modified\">\n        <time :datetime=\"modified\">{{ humanTime() }}</time>\n      </p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapMutations, mapGetters, mapState } from 'vuex'\nimport filesize from 'filesize'\nimport moment from 'moment'\nimport { files as api } from '@/api'\n\nexport default {\n  name: 'item',\n  data: function () {\n    return {\n      touches: 0\n    }\n  },\n  props: ['name', 'isDir', 'url', 'type', 'size', 'modified', 'index'],\n  computed: {\n    ...mapState(['selected', 'req']),\n    ...mapGetters(['selectedCount']),\n    isSelected () {\n      return (this.selected.indexOf(this.index) !== -1)\n    },\n    icon () {\n      if (this.isDir) return 'folder'\n      if (this.type === 'image') return 'insert_photo'\n      if (this.type === 'audio') return 'volume_up'\n      if (this.type === 'video') return 'movie'\n      return 'insert_drive_file'\n    },\n    canDrop () {\n      if (!this.isDir) return false\n\n      for (let i of this.selected) {\n        if (this.req.items[i].url === this.url) {\n          return false\n        }\n      }\n\n      return true\n    }\n  },\n  methods: {\n    ...mapMutations(['addSelected', 'removeSelected', 'resetSelected']),\n    humanSize: function () {\n      return filesize(this.size)\n    },\n    humanTime: function () {\n      return moment(this.modified).fromNow()\n    },\n    dragStart: function () {\n      if (this.selectedCount === 0) {\n        this.addSelected(this.index)\n        return\n      }\n\n      if (!this.isSelected) {\n        this.resetSelected()\n        this.addSelected(this.index)\n      }\n    },\n    dragOver: function (event) {\n      if (!this.canDrop) return\n\n      event.preventDefault()\n      let el = event.target\n\n      for (let i = 0; i < 5; i++) {\n        if (!el.classList.contains('item')) {\n          el = el.parentElement\n        }\n      }\n\n      el.style.opacity = 1\n    },\n    drop: function (event) {\n      if (!this.canDrop) return\n      event.preventDefault()\n\n      if (this.selectedCount === 0) return\n\n      let items = []\n\n      for (let i of this.selected) {\n        items.push({\n          from: this.req.items[i].url,\n          to: this.url + this.req.items[i].name\n        })\n      }\n\n      api.move(items)\n        .then(() => {\n          this.$store.commit('setReload', true)\n        })\n        .catch(this.$showError)\n    },\n    click: function (event) {\n      if (this.selectedCount !== 0) event.preventDefault()\n      if (this.$store.state.selected.indexOf(this.index) !== -1) {\n        this.removeSelected(this.index)\n        return\n      }\n\n      if (event.shiftKey) {\n        let fi = 0\n        let la = 0\n\n        if (this.index > this.selected[0]) {\n          fi = this.selected[0] + 1\n          la = this.index\n        } else {\n          fi = this.index\n          la = this.selected[0] - 1\n        }\n\n        for (; fi <= la; fi++) {\n          this.addSelected(fi)\n        }\n\n        return\n      }\n\n      if (!event.ctrlKey && !this.$store.state.multiple) this.resetSelected()\n      this.addSelected(this.index)\n    },\n    touchstart () {\n      setTimeout(() => {\n        this.touches = 0\n      }, 300)\n\n      this.touches++\n      if (this.touches > 1) {\n        this.open()\n      }\n    },\n    open: function () {\n      this.$router.push({path: this.url})\n    }\n  }\n}\n</script>\n"]}]}