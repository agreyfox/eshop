{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lq/ifb/src/eshop/frontend/src/components/Search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/components/Search.vue","mtime":1583132470972},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlLCBtYXBHZXR0ZXJzLCBtYXBNdXRhdGlvbnMgfSBmcm9tICJ2dWV4IgppbXBvcnQgdXJsIGZyb20gIkAvdXRpbHMvdXJsIgppbXBvcnQgeyBzZWFyY2ggfSBmcm9tICJAL2FwaSIKCnZhciBib3hlcyA9IHsKICBpbWFnZTogeyBsYWJlbDogImltYWdlcyIsIGljb246ICJpbnNlcnRfcGhvdG8iIH0sCiAgYXVkaW86IHsgbGFiZWw6ICJtdXNpYyIsIGljb246ICJ2b2x1bWVfdXAiIH0sCiAgdmlkZW86IHsgbGFiZWw6ICJ2aWRlbyIsIGljb246ICJtb3ZpZSIgfSwKICBwZGY6IHsgbGFiZWw6ICJwZGYiLCBpY29uOiAicGljdHVyZV9hc19wZGYiIH0KfQoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJzZWFyY2giLAogIGRhdGE6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHsKICAgICAgdmFsdWU6ICIiLAogICAgICBhY3RpdmU6IGZhbHNlLAogICAgICBvbmdvaW5nOiBmYWxzZSwKICAgICAgcmVzdWx0czogW10sCiAgICAgIHJlbG9hZDogZmFsc2UsCiAgICAgIHJlc3VsdHNDb3VudDogNTAsCiAgICAgIHNjcm9sbGFibGU6IG51bGwKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBzaG93ICh2YWwsIG9sZCkgewogICAgICB0aGlzLmFjdGl2ZSA9IHZhbCA9PT0gInNlYXJjaCIKCiAgICAgIGlmIChvbGQgPT09ICJzZWFyY2giICYmICF0aGlzLmFjdGl2ZSkgewogICAgICAgIGlmICh0aGlzLnJlbG9hZCkgewogICAgICAgICAgdGhpcy5zZXRSZWxvYWQodHJ1ZSkKICAgICAgICB9CgogICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byIKICAgICAgICB0aGlzLnJlc2V0KCkKICAgICAgICB0aGlzLnZhbHVlID0gJycKICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlCiAgICAgICAgdGhpcy4kcmVmcy5pbnB1dC5ibHVyKCkKICAgICAgfSBlbHNlIGlmICh0aGlzLmFjdGl2ZSkgewogICAgICAgIHRoaXMucmVsb2FkID0gZmFsc2UKICAgICAgICB0aGlzLiRyZWZzLmlucHV0LmZvY3VzKCkKICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiIKICAgICAgfQogICAgfSwKICAgIHZhbHVlICgpIHsKICAgICAgaWYgKHRoaXMucmVzdWx0cy5sZW5ndGgpIHsKICAgICAgICB0aGlzLnJlc2V0KCkKICAgICAgfQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcFN0YXRlKFsidXNlciIsICJzaG93Il0pLAogICAgLi4ubWFwR2V0dGVycyhbImlzTGlzdGluZyJdKSwKICAgIGJveGVzKCkgewogICAgICByZXR1cm4gYm94ZXMKICAgIH0sCiAgICBpc0VtcHR5KCkgewogICAgICByZXR1cm4gdGhpcy5yZXN1bHRzLmxlbmd0aCA9PT0gMAogICAgfSwKICAgIHRleHQoKSB7CiAgICAgIGlmICh0aGlzLm9uZ29pbmcpIHsKICAgICAgICByZXR1cm4gIiIKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09ICcnID8gdGhpcy4kdCgic2VhcmNoLnR5cGVUb1NlYXJjaCIpIDogdGhpcy4kdCgic2VhcmNoLnByZXNzVG9TZWFyY2giKQogICAgfSwKICAgIGZpbHRlcmVkUmVzdWx0cyAoKSB7CiAgICAgIHJldHVybiB0aGlzLnJlc3VsdHMuc2xpY2UoMCwgdGhpcy5yZXN1bHRzQ291bnQpCiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBldmVudCA9PiB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAyNykgewogICAgICAgIHRoaXMuY2xvc2VIb3ZlcnMoKQogICAgICB9CiAgICB9KQoKICAgIHRoaXMuJHJlZnMucmVzdWx0LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGV2ZW50ID0+IHsKICAgICAgaWYgKGV2ZW50LnRhcmdldC5vZmZzZXRIZWlnaHQgKyBldmVudC50YXJnZXQuc2Nyb2xsVG9wID49IGV2ZW50LnRhcmdldC5zY3JvbGxIZWlnaHQgLSAxMDApIHsKICAgICAgICB0aGlzLnJlc3VsdHNDb3VudCArPSA1MAogICAgICB9CiAgICB9KQogIH0sCiAgbWV0aG9kczogewogICAgLi4ubWFwTXV0YXRpb25zKFsic2hvd0hvdmVyIiwgImNsb3NlSG92ZXJzIiwgInNldFJlbG9hZCJdKSwKICAgIG9wZW4oKSB7CiAgICAgIHRoaXMuc2hvd0hvdmVyKCJzZWFyY2giKQogICAgfSwKICAgIGNsb3NlKGV2ZW50KSB7CiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKICAgICAgdGhpcy5jbG9zZUhvdmVycygpCiAgICB9LAogICAga2V5dXAoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDI3KSB7CiAgICAgICAgdGhpcy5jbG9zZShldmVudCkKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgdGhpcy5yZXN1bHRzLmxlbmd0aCA9IDAKICAgIH0sCiAgICBpbml0IChzdHJpbmcpIHsKICAgICAgdGhpcy52YWx1ZSA9IGAke3N0cmluZ30gYAogICAgICB0aGlzLiRyZWZzLmlucHV0LmZvY3VzKCkKICAgIH0sCiAgICByZXNldCAoKSB7CiAgICAgIHRoaXMub25nb2luZyA9IGZhbHNlCiAgICAgIHRoaXMucmVzdWx0c0NvdW50ID0gNTAKICAgICAgdGhpcy5yZXN1bHRzID0gW10KICAgIH0sCiAgICBhc3luYyBzdWJtaXQoZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQoKICAgICAgaWYgKHRoaXMudmFsdWUgPT09ICcnKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIGxldCBwYXRoID0gdGhpcy4kcm91dGUucGF0aAogICAgICBpZiAoIXRoaXMuaXNMaXN0aW5nKSB7CiAgICAgICAgcGF0aCA9IHVybC5yZW1vdmVMYXN0RGlyKHBhdGgpICsgIi8iCiAgICAgIH0KCiAgICAgIHRoaXMub25nb2luZyA9IHRydWUKCgogICAgICB0aGlzLnJlc3VsdHMgPSBhd2FpdCBzZWFyY2gocGF0aCwgdGhpcy52YWx1ZSkKICAgICAgdGhpcy5vbmdvaW5nID0gZmFsc2UKICAgIH0KICB9Cn0K"},{"version":3,"sources":["Search.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA","file":"Search.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"search\" @click=\"open\" v-bind:class=\"{ active , ongoing }\">\n    <div id=\"input\">\n      <button\n        v-if=\"active\"\n        class=\"action\"\n        @click=\"close\"\n        :aria-label=\"$t('buttons.close')\"\n        :title=\"$t('buttons.close')\"\n      >\n        <i class=\"material-icons\">arrow_back</i>\n      </button>\n      <i v-else class=\"material-icons\">search</i>\n      <input\n        type=\"text\"\n        @keyup.exact=\"keyup\"\n        @keyup.enter=\"submit\"\n        ref=\"input\"\n        :autofocus=\"active\"\n        v-model.trim=\"value\"\n        :aria-label=\"$t('search.search')\"\n        :placeholder=\"$t('search.search')\"\n      >\n    </div>\n\n    <div id=\"result\" ref=\"result\">\n      <div>\n        <template v-if=\"isEmpty\">\n          <p>{{ text }}</p>\n\n          <template v-if=\"value.length === 0\">\n            <div class=\"boxes\">\n              <h3>{{ $t('search.types') }}</h3>\n              <div>\n                <div\n                  tabindex=\"0\"\n                  v-for=\"(v,k) in boxes\"\n                  :key=\"k\"\n                  role=\"button\"\n                  @click=\"init('type:'+k)\"\n                  :aria-label=\"$t('search.'+v.label)\"\n                >\n                  <i class=\"material-icons\">{{v.icon}}</i>\n                  <p>{{ $t('search.'+v.label) }}</p>\n                </div>\n              </div>\n            </div>\n          </template>\n        </template>\n        <ul v-show=\"results.length > 0\">\n          <li v-for=\"(s,k) in filteredResults\" :key=\"k\">\n            <router-link @click.native=\"close\" :to=\"'./' + s.path\">\n              <i v-if=\"s.dir\" class=\"material-icons\">folder</i>\n              <i v-else class=\"material-icons\">insert_drive_file</i>\n              <span>./{{ s.path }}</span>\n            </router-link>\n          </li>\n        </ul>\n      </div>\n      <p id=\"renew\">\n        <i class=\"material-icons spin\">autorenew</i>\n      </p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters, mapMutations } from \"vuex\"\nimport url from \"@/utils/url\"\nimport { search } from \"@/api\"\n\nvar boxes = {\n  image: { label: \"images\", icon: \"insert_photo\" },\n  audio: { label: \"music\", icon: \"volume_up\" },\n  video: { label: \"video\", icon: \"movie\" },\n  pdf: { label: \"pdf\", icon: \"picture_as_pdf\" }\n}\n\nexport default {\n  name: \"search\",\n  data: function() {\n    return {\n      value: \"\",\n      active: false,\n      ongoing: false,\n      results: [],\n      reload: false,\n      resultsCount: 50,\n      scrollable: null\n    }\n  },\n  watch: {\n    show (val, old) {\n      this.active = val === \"search\"\n\n      if (old === \"search\" && !this.active) {\n        if (this.reload) {\n          this.setReload(true)\n        }\n\n        document.body.style.overflow = \"auto\"\n        this.reset()\n        this.value = ''\n        this.active = false\n        this.$refs.input.blur()\n      } else if (this.active) {\n        this.reload = false\n        this.$refs.input.focus()\n        document.body.style.overflow = \"hidden\"\n      }\n    },\n    value () {\n      if (this.results.length) {\n        this.reset()\n      }\n    }\n  },\n  computed: {\n    ...mapState([\"user\", \"show\"]),\n    ...mapGetters([\"isListing\"]),\n    boxes() {\n      return boxes\n    },\n    isEmpty() {\n      return this.results.length === 0\n    },\n    text() {\n      if (this.ongoing) {\n        return \"\"\n      }\n\n      return this.value === '' ? this.$t(\"search.typeToSearch\") : this.$t(\"search.pressToSearch\")\n    },\n    filteredResults () {\n      return this.results.slice(0, this.resultsCount)\n    }\n  },\n  mounted() {\n    window.addEventListener(\"keydown\", event => {\n      if (event.keyCode === 27) {\n        this.closeHovers()\n      }\n    })\n\n    this.$refs.result.addEventListener('scroll', event => {\n      if (event.target.offsetHeight + event.target.scrollTop >= event.target.scrollHeight - 100) {\n        this.resultsCount += 50\n      }\n    })\n  },\n  methods: {\n    ...mapMutations([\"showHover\", \"closeHovers\", \"setReload\"]),\n    open() {\n      this.showHover(\"search\")\n    },\n    close(event) {\n      event.stopPropagation()\n      event.preventDefault()\n      this.closeHovers()\n    },\n    keyup(event) {\n      if (event.keyCode === 27) {\n        this.close(event)\n        return\n      }\n\n      this.results.length = 0\n    },\n    init (string) {\n      this.value = `${string} `\n      this.$refs.input.focus()\n    },\n    reset () {\n      this.ongoing = false\n      this.resultsCount = 50\n      this.results = []\n    },\n    async submit(event) {\n      event.preventDefault()\n\n      if (this.value === '') {\n        return\n      }\n\n      let path = this.$route.path\n      if (!this.isListing) {\n        path = url.removeLastDir(path) + \"/\"\n      }\n\n      this.ongoing = true\n\n\n      this.results = await search(path, this.value)\n      this.ongoing = false\n    }\n  }\n}\n</script>\n"]}]}