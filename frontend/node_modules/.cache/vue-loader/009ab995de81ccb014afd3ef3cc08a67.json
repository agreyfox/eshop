{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lq/ifb/src/eshop/frontend/src/views/settings/User.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/views/settings/User.vue","mtime":1583132470984},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcE11dGF0aW9ucyB9IGZyb20gJ3Z1ZXgnCmltcG9ydCB7IHVzZXJzIGFzIGFwaSwgc2V0dGluZ3MgfSBmcm9tICdAL2FwaScKaW1wb3J0IFVzZXJGb3JtIGZyb20gJ0AvY29tcG9uZW50cy9zZXR0aW5ncy9Vc2VyRm9ybScKaW1wb3J0IGRlZXBDbG9uZSBmcm9tICdsb2Rhc2guY2xvbmVkZWVwJwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICd1c2VyJywKICBjb21wb25lbnRzOiB7CiAgICBVc2VyRm9ybQogIH0sCiAgZGF0YTogKCkgPT4gewogICAgcmV0dXJuIHsKICAgICAgb3JpZ2luYWxVc2VyOiBudWxsLAogICAgICB1c2VyOiB7fSwKICAgICAgbG9hZGVkOiBmYWxzZQogICAgfQogIH0sCiAgY3JlYXRlZCAoKSB7CiAgICB0aGlzLmZldGNoRGF0YSgpCiAgfSwKICBjb21wdXRlZDogewogICAgaXNOZXcgKCkgewogICAgICByZXR1cm4gdGhpcy4kcm91dGUucGF0aCA9PT0gJy9zZXR0aW5ncy91c2Vycy9uZXcnCiAgICB9CiAgfSwKICB3YXRjaDogewogICAgJyRyb3V0ZSc6ICdmZXRjaERhdGEnLAogICAgJ3VzZXIucGVybS5hZG1pbic6IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF0aGlzLnVzZXIucGVybS5hZG1pbikgcmV0dXJuCiAgICAgIHRoaXMudXNlci5sb2NrUGFzc3dvcmQgPSBmYWxzZQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLi4ubWFwTXV0YXRpb25zKFsgJ2Nsb3NlSG92ZXJzJywgJ3Nob3dIb3ZlcicsICdzZXRVc2VyJyBdKSwKICAgIGFzeW5jIGZldGNoRGF0YSAoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHRoaXMuaXNOZXcpIHsKICAgICAgICAgIGxldCB7IGRlZmF1bHRzIH0gPSBhd2FpdCBzZXR0aW5ncy5nZXQoKQogICAgICAgICAgdGhpcy51c2VyID0gewogICAgICAgICAgICAuLi5kZWZhdWx0cywKICAgICAgICAgICAgdXNlcm5hbWU6ICcnLAogICAgICAgICAgICBwYXNzc3dvcmQ6ICcnLAogICAgICAgICAgICBydWxlczogW10sCiAgICAgICAgICAgIGxvY2tQYXNzd29yZDogZmFsc2UsCiAgICAgICAgICAgIGlkOiAwCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy4kcm91dGUucGFyYW1zLnBhdGhNYXRjaAogICAgICAgICAgdGhpcy51c2VyID0geyAuLi5hd2FpdCBhcGkuZ2V0KGlkKSB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLmxvYWRlZCA9IHRydWUKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogJy9zZXR0aW5ncy91c2Vycy9uZXcnIH0pCiAgICAgIH0KICAgIH0sCiAgICBkZWxldGVQcm9tcHQgKCkgewogICAgICB0aGlzLnNob3dIb3ZlcignZGVsZXRlVXNlcicpCiAgICB9LAogICAgYXN5bmMgZGVsZXRlVXNlciAoZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQoKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBhcGkucmVtb3ZlKHRoaXMudXNlci5pZCkKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6ICcvc2V0dGluZ3MvdXNlcnMnIH0pCiAgICAgICAgdGhpcy4kc2hvd1N1Y2Nlc3ModGhpcy4kdCgnc2V0dGluZ3MudXNlckRlbGV0ZWQnKSkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuJHNob3dFcnJvcihlKQogICAgICB9CiAgICB9LAogICAgYXN5bmMgc2F2ZSAoZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQogICAgICBsZXQgdXNlciA9IHsKICAgICAgICAuLi50aGlzLm9yaWdpbmFsVXNlciwKICAgICAgICAuLi50aGlzLnVzZXIKICAgICAgfQoKICAgICAgdHJ5IHsKICAgICAgICBpZiAodGhpcy5pc05ldykgewogICAgICAgICAgY29uc3QgbG9jID0gYXdhaXQgYXBpLmNyZWF0ZSh1c2VyKQogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiBsb2MgfSkKICAgICAgICAgIHRoaXMuJHNob3dTdWNjZXNzKHRoaXMuJHQoJ3NldHRpbmdzLnVzZXJDcmVhdGVkJykpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF3YWl0IGFwaS51cGRhdGUodXNlcikKCiAgICAgICAgICBpZiAodXNlci5pZCA9PT0gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5pZCkgewogICAgICAgICAgICB0aGlzLnNldFVzZXIoeyAuLi5kZWVwQ2xvbmUodXNlcikgfSkKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLiRzaG93U3VjY2Vzcyh0aGlzLiR0KCdzZXR0aW5ncy51c2VyVXBkYXRlZCcpKQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuJHNob3dFcnJvcihlKQogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["User.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"User.vue","sourceRoot":"src/views/settings","sourcesContent":["<template>\n  <div>\n    <form v-if=\"loaded\" @submit=\"save\" class=\"card\">\n      <div class=\"card-title\">\n        <h2 v-if=\"user.id === 0\">{{ $t('settings.newUser') }}</h2>\n        <h2 v-else>{{ $t('settings.user') }} {{ user.username }}</h2>\n      </div>\n\n      <div class=\"card-content\">\n        <user-form :user.sync=\"user\" :isDefault=\"false\" :isNew=\"isNew\" />\n      </div>\n\n      <div class=\"card-action\">\n        <button\n          v-if=\"!isNew\"\n          @click.prevent=\"deletePrompt\"\n          type=\"button\"\n          class=\"button button--flat button--red\"\n          :aria-label=\"$t('buttons.delete')\"\n          :title=\"$t('buttons.delete')\">{{ $t('buttons.delete') }}</button>\n        <input\n          class=\"button button--flat\"\n          type=\"submit\"\n          :value=\"$t('buttons.save')\">\n      </div>\n    </form>\n\n    <div v-if=\"$store.state.show === 'deleteUser'\" class=\"card floating\">\n      <div class=\"card-content\">\n        <p>Are you sure you want to delete this user?</p>\n      </div>\n\n      <div class=\"card-action\">\n        <button class=\"button button--flat button--grey\"\n          @click=\"closeHovers\"\n          v-focus\n          :aria-label=\"$t('buttons.cancel')\"\n          :title=\"$t('buttons.cancel')\">\n          {{ $t('buttons.cancel') }}\n        </button>\n        <button class=\"button button--flat\"\n          @click=\"deleteUser\">\n          {{ $t('buttons.delete') }}\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapMutations } from 'vuex'\nimport { users as api, settings } from '@/api'\nimport UserForm from '@/components/settings/UserForm'\nimport deepClone from 'lodash.clonedeep'\n\nexport default {\n  name: 'user',\n  components: {\n    UserForm\n  },\n  data: () => {\n    return {\n      originalUser: null,\n      user: {},\n      loaded: false\n    }\n  },\n  created () {\n    this.fetchData()\n  },\n  computed: {\n    isNew () {\n      return this.$route.path === '/settings/users/new'\n    }\n  },\n  watch: {\n    '$route': 'fetchData',\n    'user.perm.admin': function () {\n      if (!this.user.perm.admin) return\n      this.user.lockPassword = false\n    }\n  },\n  methods: {\n    ...mapMutations([ 'closeHovers', 'showHover', 'setUser' ]),\n    async fetchData () {\n      try {\n        if (this.isNew) {\n          let { defaults } = await settings.get()\n          this.user = {\n            ...defaults,\n            username: '',\n            passsword: '',\n            rules: [],\n            lockPassword: false,\n            id: 0\n          }\n        } else {\n          const id = this.$route.params.pathMatch\n          this.user = { ...await api.get(id) }\n        }\n\n        this.loaded = true\n      } catch (e) {\n        this.$router.push({ path: '/settings/users/new' })\n      }\n    },\n    deletePrompt () {\n      this.showHover('deleteUser')\n    },\n    async deleteUser (event) {\n      event.preventDefault()\n\n      try {\n        await api.remove(this.user.id)\n        this.$router.push({ path: '/settings/users' })\n        this.$showSuccess(this.$t('settings.userDeleted'))\n      } catch (e) {\n        this.$showError(e)\n      }\n    },\n    async save (event) {\n      event.preventDefault()\n      let user = {\n        ...this.originalUser,\n        ...this.user\n      }\n\n      try {\n        if (this.isNew) {\n          const loc = await api.create(user)\n          this.$router.push({ path: loc })\n          this.$showSuccess(this.$t('settings.userCreated'))\n        } else {\n          await api.update(user)\n\n          if (user.id === this.$store.state.user.id) {\n            this.setUser({ ...deepClone(user) })\n          }\n\n          this.$showSuccess(this.$t('settings.userUpdated'))\n        }\n      } catch (e) {\n        this.$showError(e)\n      }\n    }\n  }\n}\n</script>\n"]}]}