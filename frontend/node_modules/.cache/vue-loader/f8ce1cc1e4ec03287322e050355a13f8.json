{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lq/ifb/src/eshop/frontend/src/components/files/Preview.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/components/files/Preview.vue","mtime":1583132470976},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAndnVleCcKaW1wb3J0IHVybCBmcm9tICdAL3V0aWxzL3VybCcKaW1wb3J0IHsgYmFzZVVSTCB9IGZyb20gJ0AvdXRpbHMvY29uc3RhbnRzJwppbXBvcnQgeyBmaWxlcyBhcyBhcGkgfSBmcm9tICdAL2FwaScKaW1wb3J0IEluZm9CdXR0b24gZnJvbSAnQC9jb21wb25lbnRzL2J1dHRvbnMvSW5mbycKaW1wb3J0IERlbGV0ZUJ1dHRvbiBmcm9tICdAL2NvbXBvbmVudHMvYnV0dG9ucy9EZWxldGUnCmltcG9ydCBSZW5hbWVCdXR0b24gZnJvbSAnQC9jb21wb25lbnRzL2J1dHRvbnMvUmVuYW1lJwppbXBvcnQgRG93bmxvYWRCdXR0b24gZnJvbSAnQC9jb21wb25lbnRzL2J1dHRvbnMvRG93bmxvYWQnCmltcG9ydCBFeHRlbmRlZEltYWdlIGZyb20gJy4vRXh0ZW5kZWRJbWFnZScKCmNvbnN0IG1lZGlhVHlwZXMgPSBbCiAgImltYWdlIiwKICAidmlkZW8iLAogICJhdWRpbyIsCiAgImJsb2IiCl0KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAncHJldmlldycsCiAgY29tcG9uZW50czogewogICAgSW5mb0J1dHRvbiwKICAgIERlbGV0ZUJ1dHRvbiwKICAgIFJlbmFtZUJ1dHRvbiwKICAgIERvd25sb2FkQnV0dG9uLAogICAgRXh0ZW5kZWRJbWFnZQogIH0sCiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgcHJldmlvdXNMaW5rOiAnJywKICAgICAgbmV4dExpbms6ICcnLAogICAgICBsaXN0aW5nOiBudWxsLAogICAgICBzdWJ0aXRsZXM6IFtdCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoWydyZXEnLCAndXNlcicsICdvbGRSZXEnLCAnand0J10pLAogICAgaGFzUHJldmlvdXMgKCkgewogICAgICByZXR1cm4gKHRoaXMucHJldmlvdXNMaW5rICE9PSAnJykKICAgIH0sCiAgICBoYXNOZXh0ICgpIHsKICAgICAgcmV0dXJuICh0aGlzLm5leHRMaW5rICE9PSAnJykKICAgIH0sCiAgICBkb3dubG9hZCAoKSB7CiAgICAgIHJldHVybiBgJHtiYXNlVVJMfS9hcGkvcmF3JHt0aGlzLnJlcS5wYXRofT9hdXRoPSR7dGhpcy5qd3R9YAogICAgfSwKICAgIHJhdyAoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLmRvd25sb2FkfSZpbmxpbmU9dHJ1ZWAKICAgIH0KICB9LAogIGFzeW5jIG1vdW50ZWQgKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5rZXkpCgogICAgaWYgKHRoaXMucmVxLnN1YnRpdGxlcykgewogICAgICB0aGlzLnN1YnRpdGxlcyA9IHRoaXMucmVxLnN1YnRpdGxlcy5tYXAoc3ViID0+IGAke2Jhc2VVUkx9L2FwaS9yYXcke3N1Yn0/YXV0aD0ke3RoaXMuand0fSZpbmxpbmU9dHJ1ZWApCiAgICB9CgogICAgdHJ5IHsKICAgICAgaWYgKHRoaXMub2xkUmVxLml0ZW1zKSB7CiAgICAgICAgdGhpcy51cGRhdGVMaW5rcyh0aGlzLm9sZFJlcS5pdGVtcykKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBwYXRoID0gdXJsLnJlbW92ZUxhc3REaXIodGhpcy4kcm91dGUucGF0aCkKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBhcGkuZmV0Y2gocGF0aCkKICAgICAgICB0aGlzLnVwZGF0ZUxpbmtzKHJlcy5pdGVtcykKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICB0aGlzLiRzaG93RXJyb3IoZSkKICAgIH0KICB9LAogIGJlZm9yZURlc3Ryb3kgKCkgewogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5rZXkpCiAgfSwKICBtZXRob2RzOiB7CiAgICBiYWNrICgpIHsKICAgICAgbGV0IHVyaSA9IHVybC5yZW1vdmVMYXN0RGlyKHRoaXMuJHJvdXRlLnBhdGgpICsgJy8nCiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogdXJpIH0pCiAgICB9LAogICAgcHJldiAoKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogdGhpcy5wcmV2aW91c0xpbmsgfSkKICAgIH0sCiAgICBuZXh0ICgpIHsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiB0aGlzLm5leHRMaW5rIH0pCiAgICB9LAogICAga2V5IChldmVudCkgewogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpCgogICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDEzIHx8IGV2ZW50LndoaWNoID09PSAzOSkgeyAvLyByaWdodCBhcnJvdwogICAgICAgIGlmICh0aGlzLmhhc05leHQpIHRoaXMubmV4dCgpCiAgICAgIH0gZWxzZSBpZiAoZXZlbnQud2hpY2ggPT09IDM3KSB7IC8vIGxlZnQgYXJyb3cKICAgICAgICBpZiAodGhpcy5oYXNQcmV2aW91cykgdGhpcy5wcmV2KCkKICAgICAgfQogICAgfSwKICAgIHVwZGF0ZUxpbmtzIChpdGVtcykgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGl0ZW1zW2ldLm5hbWUgIT09IHRoaXMucmVxLm5hbWUpIHsKICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgfQoKICAgICAgICBmb3IgKGxldCBqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAobWVkaWFUeXBlcy5pbmNsdWRlcyhpdGVtc1tqXS50eXBlKSkgewogICAgICAgICAgICB0aGlzLnByZXZpb3VzTGluayA9IGl0ZW1zW2pdLnVybAogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgaXRlbXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmIChtZWRpYVR5cGVzLmluY2x1ZGVzKGl0ZW1zW2pdLnR5cGUpKSB7CiAgICAgICAgICAgIHRoaXMubmV4dExpbmsgPSBpdGVtc1tqXS51cmwKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybgogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["Preview.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Preview.vue","sourceRoot":"src/components/files","sourcesContent":["<template>\n  <div id=\"previewer\">\n    <div class=\"bar\">\n      <button @click=\"back\" class=\"action\" :title=\"$t('files.closePreview')\" :aria-label=\"$t('files.closePreview')\" id=\"close\">\n        <i class=\"material-icons\">close</i>\n      </button>\n\n      <rename-button v-if=\"user.perm.rename\"></rename-button>\n      <delete-button v-if=\"user.perm.delete\"></delete-button>\n      <download-button v-if=\"user.perm.download\"></download-button>\n      <info-button></info-button>\n    </div>\n\n    <button class=\"action\" @click=\"prev\" v-show=\"hasPrevious\" :aria-label=\"$t('buttons.previous')\" :title=\"$t('buttons.previous')\">\n      <i class=\"material-icons\">chevron_left</i>\n    </button>\n    <button class=\"action\" @click=\"next\" v-show=\"hasNext\" :aria-label=\"$t('buttons.next')\" :title=\"$t('buttons.next')\">\n      <i class=\"material-icons\">chevron_right</i>\n    </button>\n\n    <div class=\"preview\">\n      <ExtendedImage v-if=\"req.type == 'image'\" :src=\"raw\"></ExtendedImage>\n      <audio v-else-if=\"req.type == 'audio'\" :src=\"raw\" autoplay controls></audio>\n      <video v-else-if=\"req.type == 'video'\" :src=\"raw\" autoplay controls>\n        <track\n          kind=\"captions\"\n          v-for=\"(sub, index) in subtitles\"\n          :key=\"index\"\n          :src=\"sub\"\n          :label=\"'Subtitle ' + index\" :default=\"index === 0\">\n        Sorry, your browser doesn't support embedded videos,\n        but don't worry, you can <a :href=\"download\">download it</a>\n        and watch it with your favorite video player!\n      </video>\n      <object v-else-if=\"req.extension == '.pdf'\" class=\"pdf\" :data=\"raw\"></object>\n      <a v-else-if=\"req.type == 'blob'\" :href=\"download\">\n        <h2 class=\"message\">{{ $t('buttons.download') }} <i class=\"material-icons\">file_download</i></h2>\n      </a>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex'\nimport url from '@/utils/url'\nimport { baseURL } from '@/utils/constants'\nimport { files as api } from '@/api'\nimport InfoButton from '@/components/buttons/Info'\nimport DeleteButton from '@/components/buttons/Delete'\nimport RenameButton from '@/components/buttons/Rename'\nimport DownloadButton from '@/components/buttons/Download'\nimport ExtendedImage from './ExtendedImage'\n\nconst mediaTypes = [\n  \"image\",\n  \"video\",\n  \"audio\",\n  \"blob\"\n]\n\nexport default {\n  name: 'preview',\n  components: {\n    InfoButton,\n    DeleteButton,\n    RenameButton,\n    DownloadButton,\n    ExtendedImage\n  },\n  data: function () {\n    return {\n      previousLink: '',\n      nextLink: '',\n      listing: null,\n      subtitles: []\n    }\n  },\n  computed: {\n    ...mapState(['req', 'user', 'oldReq', 'jwt']),\n    hasPrevious () {\n      return (this.previousLink !== '')\n    },\n    hasNext () {\n      return (this.nextLink !== '')\n    },\n    download () {\n      return `${baseURL}/api/raw${this.req.path}?auth=${this.jwt}`\n    },\n    raw () {\n      return `${this.download}&inline=true`\n    }\n  },\n  async mounted () {\n    window.addEventListener('keyup', this.key)\n\n    if (this.req.subtitles) {\n      this.subtitles = this.req.subtitles.map(sub => `${baseURL}/api/raw${sub}?auth=${this.jwt}&inline=true`)\n    }\n\n    try {\n      if (this.oldReq.items) {\n        this.updateLinks(this.oldReq.items)\n      } else {\n        const path = url.removeLastDir(this.$route.path)\n        const res = await api.fetch(path)\n        this.updateLinks(res.items)\n      }\n    } catch (e) {\n      this.$showError(e)\n    }\n  },\n  beforeDestroy () {\n    window.removeEventListener('keyup', this.key)\n  },\n  methods: {\n    back () {\n      let uri = url.removeLastDir(this.$route.path) + '/'\n      this.$router.push({ path: uri })\n    },\n    prev () {\n      this.$router.push({ path: this.previousLink })\n    },\n    next () {\n      this.$router.push({ path: this.nextLink })\n    },\n    key (event) {\n      event.preventDefault()\n\n      if (event.which === 13 || event.which === 39) { // right arrow\n        if (this.hasNext) this.next()\n      } else if (event.which === 37) { // left arrow\n        if (this.hasPrevious) this.prev()\n      }\n    },\n    updateLinks (items) {\n      for (let i = 0; i < items.length; i++) {\n        if (items[i].name !== this.req.name) {\n          continue\n        }\n\n        for (let j = i - 1; j >= 0; j--) {\n          if (mediaTypes.includes(items[j].type)) {\n            this.previousLink = items[j].url\n            break\n          }\n        }\n\n        for (let j = i + 1; j < items.length; j++) {\n          if (mediaTypes.includes(items[j].type)) {\n            this.nextLink = items[j].url\n            break\n          }\n        }\n\n        return\n      }\n    }\n  }\n}\n</script>\n"]}]}