{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lq/ifb/src/eshop/frontend/src/views/Files.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/views/Files.vue","mtime":1583132470984},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBGb3JiaWRkZW4gZnJvbSAnLi9lcnJvcnMvNDAzJwppbXBvcnQgTm90Rm91bmQgZnJvbSAnLi9lcnJvcnMvNDA0JwppbXBvcnQgSW50ZXJuYWxFcnJvciBmcm9tICcuL2Vycm9ycy81MDAnCmltcG9ydCBQcmV2aWV3IGZyb20gJ0AvY29tcG9uZW50cy9maWxlcy9QcmV2aWV3JwppbXBvcnQgTGlzdGluZyBmcm9tICdAL2NvbXBvbmVudHMvZmlsZXMvTGlzdGluZycKaW1wb3J0IHsgZmlsZXMgYXMgYXBpIH0gZnJvbSAnQC9hcGknCmltcG9ydCB7IG1hcEdldHRlcnMsIG1hcFN0YXRlLCBtYXBNdXRhdGlvbnMgfSBmcm9tICd2dWV4JwoKZnVuY3Rpb24gY2xlYW4gKHBhdGgpIHsKICByZXR1cm4gcGF0aC5lbmRzV2l0aCgnLycpID8gcGF0aC5zbGljZSgwLCAtMSkgOiBwYXRoCn0KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnZmlsZXMnLAogIGNvbXBvbmVudHM6IHsKICAgIEZvcmJpZGRlbiwKICAgIE5vdEZvdW5kLAogICAgSW50ZXJuYWxFcnJvciwKICAgIFByZXZpZXcsCiAgICBMaXN0aW5nLAogICAgRWRpdG9yOiAoKSA9PiBpbXBvcnQoJ0AvY29tcG9uZW50cy9maWxlcy9FZGl0b3InKQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoWwogICAgICAnc2VsZWN0ZWRDb3VudCcsCiAgICAgICdpc0xpc3RpbmcnLAogICAgICAnaXNFZGl0b3InLAogICAgICAnaXNGaWxlcycKICAgIF0pLAogICAgLi4ubWFwU3RhdGUoWwogICAgICAncmVxJywKICAgICAgJ3VzZXInLAogICAgICAncmVsb2FkJywKICAgICAgJ211bHRpcGxlJywKICAgICAgJ2xvYWRpbmcnCiAgICBdKSwKICAgIGlzUHJldmlldyAoKSB7CiAgICAgIHJldHVybiAhdGhpcy5sb2FkaW5nICYmICF0aGlzLmlzTGlzdGluZyAmJiAhdGhpcy5pc0VkaXRvcgogICAgfSwKICAgIGJyZWFkY3J1bWJzICgpIHsKICAgICAgbGV0IHBhcnRzID0gdGhpcy4kcm91dGUucGF0aC5zcGxpdCgnLycpCgogICAgICBpZiAocGFydHNbMF0gPT09ICcnKSB7CiAgICAgICAgcGFydHMuc2hpZnQoKQogICAgICB9CgogICAgICBpZiAocGFydHNbcGFydHMubGVuZ3RoIC0gMV0gPT09ICcnKSB7CiAgICAgICAgcGFydHMucG9wKCkKICAgICAgfQoKICAgICAgbGV0IGJyZWFkY3J1bWJzID0gW10KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYnJlYWRjcnVtYnMucHVzaCh7IG5hbWU6IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1tpXSksIHVybDogJy8nICsgcGFydHNbaV0gKyAnLycgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnJlYWRjcnVtYnMucHVzaCh7IG5hbWU6IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1tpXSksIHVybDogYnJlYWRjcnVtYnNbaSAtIDFdLnVybCArIHBhcnRzW2ldICsgJy8nIH0pCiAgICAgICAgfQogICAgICB9CgogICAgICBicmVhZGNydW1icy5zaGlmdCgpCgogICAgICBpZiAoYnJlYWRjcnVtYnMubGVuZ3RoID4gMykgewogICAgICAgIHdoaWxlIChicmVhZGNydW1icy5sZW5ndGggIT09IDQpIHsKICAgICAgICAgIGJyZWFkY3J1bWJzLnNoaWZ0KCkKICAgICAgICB9CgogICAgICAgIGJyZWFkY3J1bWJzWzBdLm5hbWUgPSAnLi4uJwogICAgICB9CgogICAgICByZXR1cm4gYnJlYWRjcnVtYnMKICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgIGVycm9yOiBudWxsCiAgICB9CiAgfSwKICBjcmVhdGVkICgpIHsKICAgIHRoaXMuZmV0Y2hEYXRhKCkKICB9LAogIHdhdGNoOiB7CiAgICAnJHJvdXRlJzogJ2ZldGNoRGF0YScsCiAgICAncmVsb2FkJzogZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmZldGNoRGF0YSgpCiAgICB9CiAgfSwKICBtb3VudGVkICgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rZXlFdmVudCkKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLnNjcm9sbCkKICB9LAogIGJlZm9yZURlc3Ryb3kgKCkgewogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmtleUV2ZW50KQogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsKQogIH0sCiAgZGVzdHJveWVkICgpIHsKICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgndXBkYXRlUmVxdWVzdCcsIHt9KQogIH0sCiAgbWV0aG9kczogewogICAgLi4ubWFwTXV0YXRpb25zKFsgJ3NldExvYWRpbmcnIF0pLAogICAgYXN5bmMgZmV0Y2hEYXRhICgpIHsKICAgICAgLy8gUmVzZXQgdmlldyBpbmZvcm1hdGlvbi4KICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRSZWxvYWQnLCBmYWxzZSkKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdyZXNldFNlbGVjdGVkJykKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdtdWx0aXBsZScsIGZhbHNlKQogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ2Nsb3NlSG92ZXJzJykKCiAgICAgIC8vIFNldCBsb2FkaW5nIHRvIHRydWUgYW5kIHJlc2V0IHRoZSBlcnJvci4KICAgICAgdGhpcy5zZXRMb2FkaW5nKHRydWUpCiAgICAgIHRoaXMuZXJyb3IgPSBudWxsCgogICAgICBsZXQgdXJsID0gdGhpcy4kcm91dGUucGF0aAogICAgICBpZiAodXJsID09PSAnJykgdXJsID0gJy8nCiAgICAgIGlmICh1cmxbMF0gIT09ICcvJykgdXJsID0gJy8nICsgdXJsCgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFwaS5mZXRjaCh1cmwpCgogICAgICAgIGlmIChjbGVhbihyZXMucGF0aCkgIT09IGNsZWFuKGAvJHt0aGlzLiRyb3V0ZS5wYXJhbXMucGF0aE1hdGNofWApKSB7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CgogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgndXBkYXRlUmVxdWVzdCcsIHJlcykKICAgICAgICBkb2N1bWVudC50aXRsZSA9IHJlcy5uYW1lCiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB0aGlzLmVycm9yID0gZQogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMuc2V0TG9hZGluZyhmYWxzZSkKICAgICAgfQogICAgfSwKICAgIGtleUV2ZW50IChldmVudCkgewogICAgICAvLyBFc2MhCiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAyNykgewogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnY2xvc2VIb3ZlcnMnKQoKICAgICAgICAvLyBJZiB3ZSdyZSBvbiBhIGxpc3RpbmcsIHVuc2VsZWN0IGFsbAogICAgICAgIC8vIGZpbGVzIGFuZCBmb2xkZXJzLgogICAgICAgIGlmICh0aGlzLmlzTGlzdGluZykgewogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdyZXNldFNlbGVjdGVkJykKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIERlbCEKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDQ2KSB7CiAgICAgICAgaWYgKHRoaXMuaXNFZGl0b3IgfHwKICAgICAgICAgICF0aGlzLmlzRmlsZXMgfHwKICAgICAgICAgIHRoaXMubG9hZGluZyB8fAogICAgICAgICAgIXRoaXMudXNlci5wZXJtLmRlbGV0ZSB8fAogICAgICAgICAgKHRoaXMuaXNMaXN0aW5nICYmIHRoaXMuc2VsZWN0ZWRDb3VudCA9PT0gMCkgfHwKICAgICAgICAgIHRoaXMuJHN0b3JlLnN0YXRlLnNob3cgIT0gbnVsbCkgcmV0dXJuCgogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd0hvdmVyJywgJ2RlbGV0ZScpCiAgICAgIH0KCiAgICAgIC8vIEYxIQogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTEyKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd0hvdmVyJywgJ2hlbHAnKQogICAgICB9CgogICAgICAvLyBGMiEKICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDExMykgewogICAgICAgIGlmICh0aGlzLmlzRWRpdG9yIHx8CiAgICAgICAgICAhdGhpcy5pc0ZpbGVzIHx8CiAgICAgICAgICB0aGlzLmxvYWRpbmcgfHwKICAgICAgICAgICF0aGlzLnVzZXIucGVybS5yZW5hbWUgfHwKICAgICAgICAgICh0aGlzLmlzTGlzdGluZyAmJiB0aGlzLnNlbGVjdGVkQ291bnQgPT09IDApIHx8CiAgICAgICAgICAodGhpcy5pc0xpc3RpbmcgJiYgdGhpcy5zZWxlY3RlZENvdW50ID4gMSkpIHJldHVybgoKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3Nob3dIb3ZlcicsICdyZW5hbWUnKQogICAgICB9CgogICAgICAvLyBDVFJMICsgUwogICAgICBpZiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSB7CiAgICAgICAgaWYgKHRoaXMuaXNFZGl0b3IpIHJldHVybgoKICAgICAgICBpZiAoU3RyaW5nLmZyb21DaGFyQ29kZShldmVudC53aGljaCkudG9Mb3dlckNhc2UoKSA9PT0gJ3MnKSB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpCgogICAgICAgICAgaWYgKHRoaXMucmVxLmtpbmQgIT09ICdlZGl0b3InKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkb3dubG9hZC1idXR0b24nKS5jbGljaygpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2Nyb2xsICgpIHsKICAgICAgaWYgKHRoaXMucmVxLmtpbmQgIT09ICdsaXN0aW5nJyB8fCB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLnZpZXdNb2RlID09PSAnbW9zYWljJykgcmV0dXJuCgogICAgICBsZXQgdG9wID0gMTEyIC0gd2luZG93LnNjcm9sbFkKCiAgICAgIGlmICh0b3AgPCA2NCkgewogICAgICAgIHRvcCA9IDY0CiAgICAgIH0KCiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsaXN0aW5nLmxpc3QgLml0ZW0uaGVhZGVyJykuc3R5bGUudG9wID0gdG9wICsgJ3B4JwogICAgfSwKICAgIG9wZW5TaWRlYmFyICgpIHsKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93SG92ZXInLCAnc2lkZWJhcicpCiAgICB9LAogICAgb3BlblNlYXJjaCAoKSB7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd0hvdmVyJywgJ3NlYXJjaCcpCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["Files.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Files.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div>\n    <div id=\"breadcrumbs\">\n      <router-link to=\"/files/\" :aria-label=\"$t('files.home')\" :title=\"$t('files.home')\">\n        <i class=\"material-icons\">home</i>\n      </router-link>\n\n      <span v-for=\"(link, index) in breadcrumbs\" :key=\"index\">\n        <span class=\"chevron\"><i class=\"material-icons\">keyboard_arrow_right</i></span>\n        <router-link :to=\"link.url\">{{ link.name }}</router-link>\n      </span>\n    </div>\n    <div v-if=\"error\">\n      <not-found v-if=\"error.message === '404'\"></not-found>\n      <forbidden v-else-if=\"error.message === '403'\"></forbidden>\n      <internal-error v-else></internal-error>\n    </div>\n    <editor v-else-if=\"isEditor\"></editor>\n    <listing :class=\"{ multiple }\" v-else-if=\"isListing\"></listing>\n    <preview v-else-if=\"isPreview\"></preview>\n    <div v-else>\n      <h2 class=\"message\">\n        <span>{{ $t('files.loading') }}</span>\n      </h2>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Forbidden from './errors/403'\nimport NotFound from './errors/404'\nimport InternalError from './errors/500'\nimport Preview from '@/components/files/Preview'\nimport Listing from '@/components/files/Listing'\nimport { files as api } from '@/api'\nimport { mapGetters, mapState, mapMutations } from 'vuex'\n\nfunction clean (path) {\n  return path.endsWith('/') ? path.slice(0, -1) : path\n}\n\nexport default {\n  name: 'files',\n  components: {\n    Forbidden,\n    NotFound,\n    InternalError,\n    Preview,\n    Listing,\n    Editor: () => import('@/components/files/Editor')\n  },\n  computed: {\n    ...mapGetters([\n      'selectedCount',\n      'isListing',\n      'isEditor',\n      'isFiles'\n    ]),\n    ...mapState([\n      'req',\n      'user',\n      'reload',\n      'multiple',\n      'loading'\n    ]),\n    isPreview () {\n      return !this.loading && !this.isListing && !this.isEditor\n    },\n    breadcrumbs () {\n      let parts = this.$route.path.split('/')\n\n      if (parts[0] === '') {\n        parts.shift()\n      }\n\n      if (parts[parts.length - 1] === '') {\n        parts.pop()\n      }\n\n      let breadcrumbs = []\n\n      for (let i = 0; i < parts.length; i++) {\n        if (i === 0) {\n          breadcrumbs.push({ name: decodeURIComponent(parts[i]), url: '/' + parts[i] + '/' })\n        } else {\n          breadcrumbs.push({ name: decodeURIComponent(parts[i]), url: breadcrumbs[i - 1].url + parts[i] + '/' })\n        }\n      }\n\n      breadcrumbs.shift()\n\n      if (breadcrumbs.length > 3) {\n        while (breadcrumbs.length !== 4) {\n          breadcrumbs.shift()\n        }\n\n        breadcrumbs[0].name = '...'\n      }\n\n      return breadcrumbs\n    }\n  },\n  data: function () {\n    return {\n      error: null\n    }\n  },\n  created () {\n    this.fetchData()\n  },\n  watch: {\n    '$route': 'fetchData',\n    'reload': function () {\n      this.fetchData()\n    }\n  },\n  mounted () {\n    window.addEventListener('keydown', this.keyEvent)\n    window.addEventListener('scroll', this.scroll)\n  },\n  beforeDestroy () {\n    window.removeEventListener('keydown', this.keyEvent)\n    window.removeEventListener('scroll', this.scroll)\n  },\n  destroyed () {\n    this.$store.commit('updateRequest', {})\n  },\n  methods: {\n    ...mapMutations([ 'setLoading' ]),\n    async fetchData () {\n      // Reset view information.\n      this.$store.commit('setReload', false)\n      this.$store.commit('resetSelected')\n      this.$store.commit('multiple', false)\n      this.$store.commit('closeHovers')\n\n      // Set loading to true and reset the error.\n      this.setLoading(true)\n      this.error = null\n\n      let url = this.$route.path\n      if (url === '') url = '/'\n      if (url[0] !== '/') url = '/' + url\n\n      try {\n        const res = await api.fetch(url)\n\n        if (clean(res.path) !== clean(`/${this.$route.params.pathMatch}`)) {\n          return\n        }\n\n        this.$store.commit('updateRequest', res)\n        document.title = res.name\n      } catch (e) {\n        this.error = e\n      } finally {\n        this.setLoading(false)\n      }\n    },\n    keyEvent (event) {\n      // Esc!\n      if (event.keyCode === 27) {\n        this.$store.commit('closeHovers')\n\n        // If we're on a listing, unselect all\n        // files and folders.\n        if (this.isListing) {\n          this.$store.commit('resetSelected')\n        }\n      }\n\n      // Del!\n      if (event.keyCode === 46) {\n        if (this.isEditor ||\n          !this.isFiles ||\n          this.loading ||\n          !this.user.perm.delete ||\n          (this.isListing && this.selectedCount === 0) ||\n          this.$store.state.show != null) return\n\n        this.$store.commit('showHover', 'delete')\n      }\n\n      // F1!\n      if (event.keyCode === 112) {\n        event.preventDefault()\n        this.$store.commit('showHover', 'help')\n      }\n\n      // F2!\n      if (event.keyCode === 113) {\n        if (this.isEditor ||\n          !this.isFiles ||\n          this.loading ||\n          !this.user.perm.rename ||\n          (this.isListing && this.selectedCount === 0) ||\n          (this.isListing && this.selectedCount > 1)) return\n\n        this.$store.commit('showHover', 'rename')\n      }\n\n      // CTRL + S\n      if (event.ctrlKey || event.metaKey) {\n        if (this.isEditor) return\n\n        if (String.fromCharCode(event.which).toLowerCase() === 's') {\n          event.preventDefault()\n\n          if (this.req.kind !== 'editor') {\n            document.getElementById('download-button').click()\n          }\n        }\n      }\n    },\n    scroll () {\n      if (this.req.kind !== 'listing' || this.$store.state.user.viewMode === 'mosaic') return\n\n      let top = 112 - window.scrollY\n\n      if (top < 64) {\n        top = 64\n      }\n\n      document.querySelector('#listing.list .item.header').style.top = top + 'px'\n    },\n    openSidebar () {\n      this.$store.commit('showHover', 'sidebar')\n    },\n    openSearch () {\n      this.$store.commit('showHover', 'search')\n    }\n  }\n}\n</script>\n"]}]}