{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lq/ifb/src/eshop/frontend/src/components/files/Listing.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/components/files/Listing.vue","mtime":1583132470972},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcFN0YXRlLCBtYXBNdXRhdGlvbnMgfSBmcm9tICd2dWV4JwppbXBvcnQgSXRlbSBmcm9tICcuL0xpc3RpbmdJdGVtJwppbXBvcnQgY3NzIGZyb20gJ0AvdXRpbHMvY3NzJwppbXBvcnQgeyB1c2VycywgZmlsZXMgYXMgYXBpIH0gZnJvbSAnQC9hcGknCmltcG9ydCBidXR0b25zIGZyb20gJ0AvdXRpbHMvYnV0dG9ucycKaW1wb3J0IHVybCBmcm9tICdAL3V0aWxzL3VybCcKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnbGlzdGluZycsCiAgY29tcG9uZW50czogeyBJdGVtIH0sCiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgc2hvdzogNTAKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZShbJ3JlcScsICdzZWxlY3RlZCcsICd1c2VyJ10pLAogICAgbmFtZVNvcnRlZCAoKSB7CiAgICAgIHJldHVybiAodGhpcy5yZXEuc29ydGluZy5ieSA9PT0gJ25hbWUnKQogICAgfSwKICAgIHNpemVTb3J0ZWQgKCkgewogICAgICByZXR1cm4gKHRoaXMucmVxLnNvcnRpbmcuYnkgPT09ICdzaXplJykKICAgIH0sCiAgICBtb2RpZmllZFNvcnRlZCAoKSB7CiAgICAgIHJldHVybiAodGhpcy5yZXEuc29ydGluZy5ieSA9PT0gJ21vZGlmaWVkJykKICAgIH0sCiAgICBhc2NPcmRlcmVkICgpIHsKICAgICAgcmV0dXJuIHRoaXMucmVxLnNvcnRpbmcuYXNjCiAgICB9LAogICAgaXRlbXMgKCkgewogICAgICBjb25zdCBkaXJzID0gW10KICAgICAgY29uc3QgZmlsZXMgPSBbXQoKICAgICAgdGhpcy5yZXEuaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgIGlmIChpdGVtLmlzRGlyKSB7CiAgICAgICAgICBkaXJzLnB1c2goaXRlbSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmlsZXMucHVzaChpdGVtKQogICAgICAgIH0KICAgICAgfSkKCiAgICAgIHJldHVybiB7IGRpcnMsIGZpbGVzIH0KICAgIH0sCiAgICBkaXJzICgpIHsKICAgICAgcmV0dXJuIHRoaXMuaXRlbXMuZGlycy5zbGljZSgwLCB0aGlzLnNob3cpCiAgICB9LAogICAgZmlsZXMgKCkgewogICAgICBsZXQgc2hvdyA9IHRoaXMuc2hvdyAtIHRoaXMuaXRlbXMuZGlycy5sZW5ndGgKCiAgICAgIGlmIChzaG93IDwgMCkgc2hvdyA9IDAKCiAgICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbGVzLnNsaWNlKDAsIHNob3cpCiAgICB9LAogICAgbmFtZUljb24gKCkgewogICAgICBpZiAodGhpcy5uYW1lU29ydGVkICYmICF0aGlzLmFzY09yZGVyZWQpIHsKICAgICAgICByZXR1cm4gJ2Fycm93X3Vwd2FyZCcKICAgICAgfQoKICAgICAgcmV0dXJuICdhcnJvd19kb3dud2FyZCcKICAgIH0sCiAgICBzaXplSWNvbiAoKSB7CiAgICAgIGlmICh0aGlzLnNpemVTb3J0ZWQgJiYgdGhpcy5hc2NPcmRlcmVkKSB7CiAgICAgICAgcmV0dXJuICdhcnJvd19kb3dud2FyZCcKICAgICAgfQoKICAgICAgcmV0dXJuICdhcnJvd191cHdhcmQnCiAgICB9LAogICAgbW9kaWZpZWRJY29uICgpIHsKICAgICAgaWYgKHRoaXMubW9kaWZpZWRTb3J0ZWQgJiYgdGhpcy5hc2NPcmRlcmVkKSB7CiAgICAgICAgcmV0dXJuICdhcnJvd19kb3dud2FyZCcKICAgICAgfQoKICAgICAgcmV0dXJuICdhcnJvd191cHdhcmQnCiAgICB9CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiAoKSB7CiAgICAvLyBDaGVjayB0aGUgY29sdW1ucyBzaXplIGZvciB0aGUgZmlyc3QgdGltZS4KICAgIHRoaXMucmVzaXplRXZlbnQoKQoKICAgIC8vIEFkZCB0aGUgbmVlZGVkIGV2ZW50IGxpc3RlbmVycyB0byB0aGUgd2luZG93IGFuZCBkb2N1bWVudC4KICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rZXlFdmVudCkKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnJlc2l6ZUV2ZW50KQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsRXZlbnQpCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMucHJldmVudERlZmF1bHQpCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcm9wKQogIH0sCiAgYmVmb3JlRGVzdHJveSAoKSB7CiAgICAvLyBSZW1vdmUgZXZlbnQgbGlzdGVuZXJzIGJlZm9yZSBkZXN0cm95aW5nIHRoaXMgcGFnZS4KICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5rZXlFdmVudCkKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLnJlc2l6ZUV2ZW50KQogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuc2Nyb2xsRXZlbnQpCiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMucHJldmVudERlZmF1bHQpCiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdkcm9wJywgdGhpcy5kcm9wKQogIH0sCiAgbWV0aG9kczogewogICAgLi4ubWFwTXV0YXRpb25zKFsgJ3VwZGF0ZVVzZXInIF0pLAogICAgYmFzZTY0OiBmdW5jdGlvbiAobmFtZSkgewogICAgICByZXR1cm4gd2luZG93LmJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KG5hbWUpKSkKICAgIH0sCiAgICBrZXlFdmVudCAoZXZlbnQpIHsKICAgICAgaWYgKCFldmVudC5jdHJsS2V5ICYmICFldmVudC5tZXRhS2V5KSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIGxldCBrZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGV2ZW50LndoaWNoKS50b0xvd2VyQ2FzZSgpCgogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgJ2YnOgogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQogICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93SG92ZXInLCAnc2VhcmNoJykKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnYyc6CiAgICAgICAgY2FzZSAneCc6CiAgICAgICAgICB0aGlzLmNvcHlDdXQoZXZlbnQsIGtleSkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAndic6CiAgICAgICAgICB0aGlzLnBhc3RlKGV2ZW50KQogICAgICAgICAgYnJlYWsKICAgICAgfQogICAgfSwKICAgIHByZXZlbnREZWZhdWx0IChldmVudCkgewogICAgICAvLyBXcmFwcGVyIGFyb3VuZCBwcmV2ZW50IGRlZmF1bHQuCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKICAgIH0sCiAgICBjb3B5Q3V0IChldmVudCwga2V5KSB7CiAgICAgIGlmIChldmVudC50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIGxldCBpdGVtcyA9IFtdCgogICAgICBmb3IgKGxldCBpIG9mIHRoaXMuc2VsZWN0ZWQpIHsKICAgICAgICBpdGVtcy5wdXNoKHsKICAgICAgICAgIGZyb206IHRoaXMucmVxLml0ZW1zW2ldLnVybCwKICAgICAgICAgIG5hbWU6IGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnJlcS5pdGVtc1tpXS5uYW1lKQogICAgICAgIH0pCiAgICAgIH0KCiAgICAgIGlmIChpdGVtcy5sZW5ndGggPT0gMCkgewogICAgICAgIHJldHVybgogICAgICB9CgogICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3VwZGF0ZUNsaXBib2FyZCcsIHsKICAgICAgICBrZXk6IGtleSwKICAgICAgICBpdGVtczogaXRlbXMKICAgICAgfSkKICAgIH0sCiAgICBwYXN0ZSAoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dCcpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgbGV0IGl0ZW1zID0gW10KCiAgICAgIGZvciAobGV0IGl0ZW0gb2YgdGhpcy4kc3RvcmUuc3RhdGUuY2xpcGJvYXJkLml0ZW1zKSB7CiAgICAgICAgY29uc3QgZnJvbSA9IGl0ZW0uZnJvbS5lbmRzV2l0aCgnLycpID8gaXRlbS5mcm9tLnNsaWNlKDAsIC0xKSA6IGl0ZW0uZnJvbQogICAgICAgIGNvbnN0IHRvID0gdGhpcy4kcm91dGUucGF0aCArIGl0ZW0ubmFtZQogICAgICAgIGl0ZW1zLnB1c2goeyBmcm9tLCB0byB9KQogICAgICB9CgogICAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIGlmICh0aGlzLiRzdG9yZS5zdGF0ZS5jbGlwYm9hcmQua2V5ID09PSAneCcpIHsKICAgICAgICBhcGkubW92ZShpdGVtcykudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFJlbG9hZCcsIHRydWUpCiAgICAgICAgfSkuY2F0Y2godGhpcy4kc2hvd0Vycm9yKQogICAgICAgIHJldHVybgogICAgICB9CgogICAgICBhcGkuY29weShpdGVtcykudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRSZWxvYWQnLCB0cnVlKQogICAgICB9KS5jYXRjaCh0aGlzLiRzaG93RXJyb3IpCiAgICB9LAogICAgcmVzaXplRXZlbnQgKCkgewogICAgICAvLyBVcGRhdGUgdGhlIGNvbHVtbnMgc2l6ZSBiYXNlZCBvbiB0aGUgd2luZG93IHdpZHRoLgogICAgICBsZXQgY29sdW1ucyA9IE1hdGguZmxvb3IoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWFpbicpLm9mZnNldFdpZHRoIC8gMzAwKQogICAgICBsZXQgaXRlbXMgPSBjc3MoWycjbGlzdGluZy5tb3NhaWMgLml0ZW0nLCAnLm1vc2FpYyNsaXN0aW5nIC5pdGVtJ10pCiAgICAgIGlmIChjb2x1bW5zID09PSAwKSBjb2x1bW5zID0gMQogICAgICBpdGVtcy5zdHlsZS53aWR0aCA9IGBjYWxjKCR7MTAwIC8gY29sdW1uc30lIC0gMWVtKWAKICAgIH0sCiAgICBzY3JvbGxFdmVudCAoKSB7CiAgICAgIGlmICgod2luZG93LmlubmVySGVpZ2h0ICsgd2luZG93LnNjcm9sbFkpID49IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0KSB7CiAgICAgICAgdGhpcy5zaG93ICs9IDUwCiAgICAgIH0KICAgIH0sCiAgICBkcmFnRW50ZXIgKCkgewogICAgICAvLyBXaGVuIHRoZSB1c2VyIHN0YXJ0cyBkcmFnZ2luZyBhbiBpdGVtLCBwdXQgZXZlcnkKICAgICAgLy8gZmlsZSBvbiB0aGUgbGlzdGluZyB3aXRoIDUwJSBvcGFjaXR5LgogICAgICBsZXQgaXRlbXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdpdGVtJykKCiAgICAgIEFycmF5LmZyb20oaXRlbXMpLmZvckVhY2goZmlsZSA9PiB7CiAgICAgICAgZmlsZS5zdHlsZS5vcGFjaXR5ID0gMC41CiAgICAgIH0pCiAgICB9LAogICAgZHJhZ0VuZCAoKSB7CiAgICAgIHRoaXMucmVzZXRPcGFjaXR5KCkKICAgIH0sCiAgICBkcm9wOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQogICAgICB0aGlzLnJlc2V0T3BhY2l0eSgpCgogICAgICBsZXQgZHQgPSBldmVudC5kYXRhVHJhbnNmZXIKICAgICAgbGV0IGZpbGVzID0gZHQuZmlsZXMKICAgICAgbGV0IGVsID0gZXZlbnQudGFyZ2V0CgogICAgICBpZiAoZmlsZXMubGVuZ3RoIDw9IDApIHJldHVybgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoZWwgIT09IG51bGwgJiYgIWVsLmNsYXNzTGlzdC5jb250YWlucygnaXRlbScpKSB7CiAgICAgICAgICBlbCA9IGVsLnBhcmVudEVsZW1lbnQKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGxldCBiYXNlID0gJycKICAgICAgaWYgKGVsICE9PSBudWxsICYmIGVsLmNsYXNzTGlzdC5jb250YWlucygnaXRlbScpICYmIGVsLmRhdGFzZXQuZGlyID09PSAndHJ1ZScpIHsKICAgICAgICBiYXNlID0gZWwucXVlcnlTZWxlY3RvcignLm5hbWUnKS5pbm5lckhUTUwgKyAnLycKICAgICAgfQoKICAgICAgaWYgKGJhc2UgIT09ICcnKSB7CiAgICAgICAgYXBpLmZldGNoKHRoaXMuJHJvdXRlLnBhdGggKyBiYXNlKQogICAgICAgICAgLnRoZW4ocmVxID0+IHsKICAgICAgICAgICAgdGhpcy5jaGVja0NvbmZsaWN0KGZpbGVzLCByZXEuaXRlbXMsIGJhc2UpCiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKHRoaXMuJHNob3dFcnJvcikKCiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHRoaXMuY2hlY2tDb25mbGljdChmaWxlcywgdGhpcy5yZXEuaXRlbXMsIGJhc2UpCiAgICB9LAogICAgY2hlY2tDb25mbGljdCAoZmlsZXMsIGl0ZW1zLCBiYXNlKSB7CiAgICAgIGlmICh0eXBlb2YgaXRlbXMgPT09ICd1bmRlZmluZWQnIHx8IGl0ZW1zID09PSBudWxsKSB7CiAgICAgICAgaXRlbXMgPSBbXQogICAgICB9CgogICAgICBsZXQgY29uZmxpY3QgPSBmYWxzZQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHJlcyA9IGl0ZW1zLmZpbmRJbmRleChmdW5jdGlvbiBoYXNDb25mbGljdCAoZWxlbWVudCkgewogICAgICAgICAgcmV0dXJuIChlbGVtZW50Lm5hbWUgPT09IHRoaXMpCiAgICAgICAgfSwgZmlsZXNbaV0ubmFtZSkKCiAgICAgICAgaWYgKHJlcyA+PSAwKSB7CiAgICAgICAgICBjb25mbGljdCA9IHRydWUKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWNvbmZsaWN0KSB7CiAgICAgICAgdGhpcy5oYW5kbGVGaWxlcyhmaWxlcywgYmFzZSkKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93SG92ZXInLCB7CiAgICAgICAgcHJvbXB0OiAncmVwbGFjZScsCiAgICAgICAgY29uZmlybTogKGV2ZW50KSA9PiB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ2Nsb3NlSG92ZXJzJykKICAgICAgICAgIHRoaXMuaGFuZGxlRmlsZXMoZmlsZXMsIGJhc2UsIHRydWUpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIHVwbG9hZElucHV0IChldmVudCkgewogICAgICB0aGlzLmNoZWNrQ29uZmxpY3QoZXZlbnQuY3VycmVudFRhcmdldC5maWxlcywgdGhpcy5yZXEuaXRlbXMsICcnKQogICAgfSwKICAgIHJlc2V0T3BhY2l0eSAoKSB7CiAgICAgIGxldCBpdGVtcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2l0ZW0nKQoKICAgICAgQXJyYXkuZnJvbShpdGVtcykuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICBmaWxlLnN0eWxlLm9wYWNpdHkgPSAxCiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlRmlsZXMgKGZpbGVzLCBiYXNlLCBvdmVyd3JpdGUgPSBmYWxzZSkgewogICAgICBidXR0b25zLmxvYWRpbmcoJ3VwbG9hZCcpCiAgICAgIGxldCBwcm9taXNlcyA9IFtdCiAgICAgIGxldCBwcm9ncmVzcyA9IG5ldyBBcnJheShmaWxlcy5sZW5ndGgpLmZpbGwoMCkKCiAgICAgIGxldCBvbnVwbG9hZCA9IChpZCkgPT4gKGV2ZW50KSA9PiB7CiAgICAgICAgcHJvZ3Jlc3NbaWRdID0gKGV2ZW50LmxvYWRlZCAvIGV2ZW50LnRvdGFsKSAqIDEwMAoKICAgICAgICBsZXQgc3VtID0gMAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvZ3Jlc3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHN1bSArPSBwcm9ncmVzc1tpXQogICAgICAgIH0KCiAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdzZXRQcm9ncmVzcycsIE1hdGguY2VpbChzdW0gLyBwcm9ncmVzcy5sZW5ndGgpKQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGZpbGUgPSBmaWxlc1tpXQogICAgICAgIGxldCBmaWxlbmFtZUVuY29kZWQgPSB1cmwuZW5jb2RlUkZDNTk4N1ZhbHVlQ2hhcnMoZmlsZS5uYW1lKQogICAgICAgIHByb21pc2VzLnB1c2goYXBpLnBvc3QodGhpcy4kcm91dGUucGF0aCArIGJhc2UgKyBmaWxlbmFtZUVuY29kZWQsIGZpbGUsIG92ZXJ3cml0ZSwgb251cGxvYWQoaSkpKQogICAgICB9CgogICAgICBsZXQgZmluaXNoID0gKCkgPT4gewogICAgICAgIGJ1dHRvbnMuc3VjY2VzcygndXBsb2FkJykKICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldFByb2dyZXNzJywgMCkKICAgICAgfQoKICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgZmluaXNoKCkKICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0UmVsb2FkJywgdHJ1ZSkKICAgICAgICB9KQogICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICBmaW5pc2goKQogICAgICAgICAgdGhpcy4kc2hvd0Vycm9yKGVycm9yKQogICAgICAgIH0pCgogICAgICByZXR1cm4gZmFsc2UKICAgIH0sCiAgICBhc3luYyBzb3J0IChieSkgewogICAgICBsZXQgYXNjID0gZmFsc2UKCiAgICAgIGlmIChieSA9PT0gJ25hbWUnKSB7CiAgICAgICAgaWYgKHRoaXMubmFtZUljb24gPT09ICdhcnJvd191cHdhcmQnKSB7CiAgICAgICAgICBhc2MgPSB0cnVlCiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGJ5ID09PSAnc2l6ZScpIHsKICAgICAgICBpZiAodGhpcy5zaXplSWNvbiA9PT0gJ2Fycm93X3Vwd2FyZCcpIHsKICAgICAgICAgIGFzYyA9IHRydWUKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoYnkgPT09ICdtb2RpZmllZCcpIHsKICAgICAgICBpZiAodGhpcy5tb2RpZmllZEljb24gPT09ICdhcnJvd191cHdhcmQnKSB7CiAgICAgICAgICBhc2MgPSB0cnVlCiAgICAgICAgfQogICAgICB9CgogICAgICB0cnkgewogICAgICAgIGF3YWl0IHVzZXJzLnVwZGF0ZSh7IGlkOiB0aGlzLnVzZXIuaWQsIHNvcnRpbmc6IHsgYnksIGFzYyB9IH0sIFsnc29ydGluZyddKQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgdGhpcy4kc2hvd0Vycm9yKGUpCiAgICAgIH0KCiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2V0UmVsb2FkJywgdHJ1ZSkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["Listing.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"Listing.vue","sourceRoot":"src/components/files","sourcesContent":["<template>\n  <div v-if=\"(req.numDirs + req.numFiles) == 0\">\n    <h2 class=\"message\">\n      <i class=\"material-icons\">sentiment_dissatisfied</i>\n      <span>{{ $t('files.lonely') }}</span>\n    </h2>\n    <input style=\"display:none\" type=\"file\" id=\"upload-input\" @change=\"uploadInput($event)\" multiple>\n  </div>\n  <div v-else id=\"listing\"\n    :class=\"user.viewMode\"\n    @dragenter=\"dragEnter\"\n    @dragend=\"dragEnd\">\n    <div>\n      <div class=\"item header\">\n        <div></div>\n        <div>\n          <p :class=\"{ active: nameSorted }\" class=\"name\"\n            role=\"button\"\n            tabindex=\"0\"\n            @click=\"sort('name')\"\n            :title=\"$t('files.sortByName')\"\n            :aria-label=\"$t('files.sortByName')\">\n            <span>{{ $t('files.name') }}</span>\n            <i class=\"material-icons\">{{ nameIcon }}</i>\n          </p>\n\n          <p :class=\"{ active: sizeSorted }\" class=\"size\"\n            role=\"button\"\n            tabindex=\"0\"\n            @click=\"sort('size')\"\n            :title=\"$t('files.sortBySize')\"\n            :aria-label=\"$t('files.sortBySize')\">\n            <span>{{ $t('files.size') }}</span>\n            <i class=\"material-icons\">{{ sizeIcon }}</i>\n          </p>\n          <p :class=\"{ active: modifiedSorted }\" class=\"modified\"\n            role=\"button\"\n            tabindex=\"0\"\n            @click=\"sort('modified')\"\n            :title=\"$t('files.sortByLastModified')\"\n            :aria-label=\"$t('files.sortByLastModified')\">\n            <span>{{ $t('files.lastModified') }}</span>\n            <i class=\"material-icons\">{{ modifiedIcon }}</i>\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <h2 v-if=\"req.numDirs > 0\">{{ $t('files.folders') }}</h2>\n    <div v-if=\"req.numDirs > 0\">\n      <item v-for=\"(item) in dirs\"\n        :key=\"base64(item.name)\"\n        v-bind:index=\"item.index\"\n        v-bind:name=\"item.name\"\n        v-bind:isDir=\"item.isDir\"\n        v-bind:url=\"item.url\"\n        v-bind:modified=\"item.modified\"\n        v-bind:type=\"item.type\"\n        v-bind:size=\"item.size\">\n      </item>\n    </div>\n\n    <h2 v-if=\"req.numFiles > 0\">{{ $t('files.files') }}</h2>\n    <div v-if=\"req.numFiles > 0\">\n      <item v-for=\"(item) in files\"\n        :key=\"base64(item.name)\"\n        v-bind:index=\"item.index\"\n        v-bind:name=\"item.name\"\n        v-bind:isDir=\"item.isDir\"\n        v-bind:url=\"item.url\"\n        v-bind:modified=\"item.modified\"\n        v-bind:type=\"item.type\"\n        v-bind:size=\"item.size\">\n      </item>\n    </div>\n\n    <input style=\"display:none\" type=\"file\" id=\"upload-input\" @change=\"uploadInput($event)\" multiple>\n\n    <div :class=\"{ active: $store.state.multiple }\" id=\"multiple-selection\">\n    <p>{{ $t('files.multipleSelectionEnabled') }}</p>\n      <div @click=\"$store.commit('multiple', false)\" tabindex=\"0\" role=\"button\" :title=\"$t('files.clear')\" :aria-label=\"$t('files.clear')\" class=\"action\">\n        <i class=\"material-icons\">clear</i>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapMutations } from 'vuex'\nimport Item from './ListingItem'\nimport css from '@/utils/css'\nimport { users, files as api } from '@/api'\nimport buttons from '@/utils/buttons'\nimport url from '@/utils/url'\n\nexport default {\n  name: 'listing',\n  components: { Item },\n  data: function () {\n    return {\n      show: 50\n    }\n  },\n  computed: {\n    ...mapState(['req', 'selected', 'user']),\n    nameSorted () {\n      return (this.req.sorting.by === 'name')\n    },\n    sizeSorted () {\n      return (this.req.sorting.by === 'size')\n    },\n    modifiedSorted () {\n      return (this.req.sorting.by === 'modified')\n    },\n    ascOrdered () {\n      return this.req.sorting.asc\n    },\n    items () {\n      const dirs = []\n      const files = []\n\n      this.req.items.forEach((item) => {\n        if (item.isDir) {\n          dirs.push(item)\n        } else {\n          files.push(item)\n        }\n      })\n\n      return { dirs, files }\n    },\n    dirs () {\n      return this.items.dirs.slice(0, this.show)\n    },\n    files () {\n      let show = this.show - this.items.dirs.length\n\n      if (show < 0) show = 0\n\n      return this.items.files.slice(0, show)\n    },\n    nameIcon () {\n      if (this.nameSorted && !this.ascOrdered) {\n        return 'arrow_upward'\n      }\n\n      return 'arrow_downward'\n    },\n    sizeIcon () {\n      if (this.sizeSorted && this.ascOrdered) {\n        return 'arrow_downward'\n      }\n\n      return 'arrow_upward'\n    },\n    modifiedIcon () {\n      if (this.modifiedSorted && this.ascOrdered) {\n        return 'arrow_downward'\n      }\n\n      return 'arrow_upward'\n    }\n  },\n  mounted: function () {\n    // Check the columns size for the first time.\n    this.resizeEvent()\n\n    // Add the needed event listeners to the window and document.\n    window.addEventListener('keydown', this.keyEvent)\n    window.addEventListener('resize', this.resizeEvent)\n    window.addEventListener('scroll', this.scrollEvent)\n    document.addEventListener('dragover', this.preventDefault)\n    document.addEventListener('drop', this.drop)\n  },\n  beforeDestroy () {\n    // Remove event listeners before destroying this page.\n    window.removeEventListener('keydown', this.keyEvent)\n    window.removeEventListener('resize', this.resizeEvent)\n    window.removeEventListener('scroll', this.scrollEvent)\n    document.removeEventListener('dragover', this.preventDefault)\n    document.removeEventListener('drop', this.drop)\n  },\n  methods: {\n    ...mapMutations([ 'updateUser' ]),\n    base64: function (name) {\n      return window.btoa(unescape(encodeURIComponent(name)))\n    },\n    keyEvent (event) {\n      if (!event.ctrlKey && !event.metaKey) {\n        return\n      }\n\n      let key = String.fromCharCode(event.which).toLowerCase()\n\n      switch (key) {\n        case 'f':\n          event.preventDefault()\n          this.$store.commit('showHover', 'search')\n          break\n        case 'c':\n        case 'x':\n          this.copyCut(event, key)\n          break\n        case 'v':\n          this.paste(event)\n          break\n      }\n    },\n    preventDefault (event) {\n      // Wrapper around prevent default.\n      event.preventDefault()\n    },\n    copyCut (event, key) {\n      if (event.target.tagName.toLowerCase() === 'input') {\n        return\n      }\n\n      let items = []\n\n      for (let i of this.selected) {\n        items.push({\n          from: this.req.items[i].url,\n          name: encodeURIComponent(this.req.items[i].name)\n        })\n      }\n\n      if (items.length == 0) {\n        return\n      }\n\n      this.$store.commit('updateClipboard', {\n        key: key,\n        items: items\n      })\n    },\n    paste (event) {\n      if (event.target.tagName.toLowerCase() === 'input') {\n        return\n      }\n\n      let items = []\n\n      for (let item of this.$store.state.clipboard.items) {\n        const from = item.from.endsWith('/') ? item.from.slice(0, -1) : item.from\n        const to = this.$route.path + item.name\n        items.push({ from, to })\n      }\n\n      if (items.length === 0) {\n        return\n      }\n\n      if (this.$store.state.clipboard.key === 'x') {\n        api.move(items).then(() => {\n          this.$store.commit('setReload', true)\n        }).catch(this.$showError)\n        return\n      }\n\n      api.copy(items).then(() => {\n        this.$store.commit('setReload', true)\n      }).catch(this.$showError)\n    },\n    resizeEvent () {\n      // Update the columns size based on the window width.\n      let columns = Math.floor(document.querySelector('main').offsetWidth / 300)\n      let items = css(['#listing.mosaic .item', '.mosaic#listing .item'])\n      if (columns === 0) columns = 1\n      items.style.width = `calc(${100 / columns}% - 1em)`\n    },\n    scrollEvent () {\n      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {\n        this.show += 50\n      }\n    },\n    dragEnter () {\n      // When the user starts dragging an item, put every\n      // file on the listing with 50% opacity.\n      let items = document.getElementsByClassName('item')\n\n      Array.from(items).forEach(file => {\n        file.style.opacity = 0.5\n      })\n    },\n    dragEnd () {\n      this.resetOpacity()\n    },\n    drop: function (event) {\n      event.preventDefault()\n      this.resetOpacity()\n\n      let dt = event.dataTransfer\n      let files = dt.files\n      let el = event.target\n\n      if (files.length <= 0) return\n\n      for (let i = 0; i < 5; i++) {\n        if (el !== null && !el.classList.contains('item')) {\n          el = el.parentElement\n        }\n      }\n\n      let base = ''\n      if (el !== null && el.classList.contains('item') && el.dataset.dir === 'true') {\n        base = el.querySelector('.name').innerHTML + '/'\n      }\n\n      if (base !== '') {\n        api.fetch(this.$route.path + base)\n          .then(req => {\n            this.checkConflict(files, req.items, base)\n          })\n          .catch(this.$showError)\n\n        return\n      }\n\n      this.checkConflict(files, this.req.items, base)\n    },\n    checkConflict (files, items, base) {\n      if (typeof items === 'undefined' || items === null) {\n        items = []\n      }\n\n      let conflict = false\n      for (let i = 0; i < files.length; i++) {\n        let res = items.findIndex(function hasConflict (element) {\n          return (element.name === this)\n        }, files[i].name)\n\n        if (res >= 0) {\n          conflict = true\n          break\n        }\n      }\n\n      if (!conflict) {\n        this.handleFiles(files, base)\n        return\n      }\n\n      this.$store.commit('showHover', {\n        prompt: 'replace',\n        confirm: (event) => {\n          event.preventDefault()\n          this.$store.commit('closeHovers')\n          this.handleFiles(files, base, true)\n        }\n      })\n    },\n    uploadInput (event) {\n      this.checkConflict(event.currentTarget.files, this.req.items, '')\n    },\n    resetOpacity () {\n      let items = document.getElementsByClassName('item')\n\n      Array.from(items).forEach(file => {\n        file.style.opacity = 1\n      })\n    },\n    handleFiles (files, base, overwrite = false) {\n      buttons.loading('upload')\n      let promises = []\n      let progress = new Array(files.length).fill(0)\n\n      let onupload = (id) => (event) => {\n        progress[id] = (event.loaded / event.total) * 100\n\n        let sum = 0\n        for (let i = 0; i < progress.length; i++) {\n          sum += progress[i]\n        }\n\n        this.$store.commit('setProgress', Math.ceil(sum / progress.length))\n      }\n\n      for (let i = 0; i < files.length; i++) {\n        let file = files[i]\n        let filenameEncoded = url.encodeRFC5987ValueChars(file.name)\n        promises.push(api.post(this.$route.path + base + filenameEncoded, file, overwrite, onupload(i)))\n      }\n\n      let finish = () => {\n        buttons.success('upload')\n        this.$store.commit('setProgress', 0)\n      }\n\n      Promise.all(promises)\n        .then(() => {\n          finish()\n          this.$store.commit('setReload', true)\n        })\n        .catch(error => {\n          finish()\n          this.$showError(error)\n        })\n\n      return false\n    },\n    async sort (by) {\n      let asc = false\n\n      if (by === 'name') {\n        if (this.nameIcon === 'arrow_upward') {\n          asc = true\n        }\n      } else if (by === 'size') {\n        if (this.sizeIcon === 'arrow_upward') {\n          asc = true\n        }\n      } else if (by === 'modified') {\n        if (this.modifiedIcon === 'arrow_upward') {\n          asc = true\n        }\n      }\n\n      try {\n        await users.update({ id: this.user.id, sorting: { by, asc } }, ['sorting'])\n      } catch (e) {\n        this.$showError(e)\n      }\n\n      this.$store.commit('setReload', true)\n    }\n  }\n}\n</script>\n"]}]}