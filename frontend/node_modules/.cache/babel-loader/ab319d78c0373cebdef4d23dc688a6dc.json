{"remainingRequest":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js!/home/lq/ifb/src/eshop/frontend/node_modules/eslint-loader/index.js??ref--13-0!/home/lq/ifb/src/eshop/frontend/src/utils/auth.js","dependencies":[{"path":"/home/lq/ifb/src/eshop/frontend/src/utils/auth.js","mtime":1585894410896},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lq/ifb/src/eshop/frontend/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvaG9tZS9scS9pZmIvc3JjL2VzaG9wL2Zyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IHN0b3JlIGZyb20gJ0Avc3RvcmUnOwppbXBvcnQgcm91dGVyIGZyb20gJ0Avcm91dGVyJzsKaW1wb3J0IHsgQmFzZTY0IH0gZnJvbSAnanMtYmFzZTY0JzsgLy9pbXBvcnQgeyBiYXNlVVJMIH0gZnJvbSAnQC91dGlscy9jb25zdGFudHMnCgppbXBvcnQgeyBhcGlTZXJ2ZXIgfSBmcm9tICcuL2NvbnN0YW50cyc7CmV4cG9ydCBmdW5jdGlvbiBwYXJzZVRva2VuKHRva2VuKSB7CiAgaWYgKCF0b2tlbikgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIHBhcnRzID0gdG9rZW4uc3BsaXQoJy4nKTsKCiAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMykgewogICAgdGhyb3cgbmV3IEVycm9yKCd0b2tlbiBtYWxmb3JtZWQnKTsKICB9CgogIHZhciBkYXRhID0gSlNPTi5wYXJzZShCYXNlNjQuZGVjb2RlKHBhcnRzWzFdKSk7CgogIGlmIChNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgPiBkYXRhLmV4cCkgewogICAgdGhyb3cgbmV3IEVycm9yKCd0b2tlbiBleHBpcmVkJyk7CiAgfQoKICBjb25zb2xlLmxvZyhkYXRhKTsKICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnand0JywgdG9rZW4pOwogIHN0b3JlLmNvbW1pdCgnc2V0SldUJywgdG9rZW4pOwogIHN0b3JlLmNvbW1pdCgnc2V0VXNlcicsIGRhdGEudXNlcik7Cn0KZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlTG9naW4oKSB7CiAgcmV0dXJuIF92YWxpZGF0ZUxvZ2luLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIF92YWxpZGF0ZUxvZ2luKCkgewogIF92YWxpZGF0ZUxvZ2luID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwOwoKICAgICAgICAgICAgaWYgKCFsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnand0JykpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgIHJldHVybiByZW5ldyhsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnand0JykpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDY7CiAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgIGNvbnNvbGUud2FybignSW52YWxpZCBKV1QgdG9rZW4gaW4gc3RvcmFnZScpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCgogICAgICAgICAgY2FzZSA5OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbMCwgNl1dKTsKICB9KSk7CiAgcmV0dXJuIF92YWxpZGF0ZUxvZ2luLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmV4cG9ydCBmdW5jdGlvbiBsb2dpbihfeCwgX3gyKSB7CiAgcmV0dXJuIF9sb2dpbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfbG9naW4oKSB7CiAgX2xvZ2luID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKGVtYWlsLCBwYXNzd29yZCkgewogICAgdmFyIHJlcywgYm9keTsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGlmIChlbWFpbCkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICByZXR1cm4gZmV0Y2goIiIuY29uY2F0KGFwaVNlcnZlciwgIi9hcGkvdXNlci9sb2dpbiIpLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgImVtYWlsIjogZW1haWwsCiAgICAgICAgICAgICAgICAicGFzc3dvcmQiOiBwYXNzd29yZAogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgcmVzID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7CgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBib2R5ID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICBpZiAoIShyZXMuc3RhdHVzID09PSAyMDAgJiYgYm9keS5yZXRDb2RlID49IDApKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyogbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2p3dCcsIGJvZHkuZGF0YSkKICAgICAgICAgICAgc3RvcmUuY29tbWl0KCdzZXRKV1QnLCBib2R5LmRhdGEpCiAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnc2V0VXNlcicsIHVzZXIpICovCiAgICAgICAgICAgIHBhcnNlVG9rZW4oYm9keS5kYXRhKTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGJvZHkpOwoKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUyKTsKICB9KSk7CiAgcmV0dXJuIF9sb2dpbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpleHBvcnQgZnVuY3Rpb24gcmVuZXcoX3gzKSB7CiAgcmV0dXJuIF9yZW5ldy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfcmVuZXcoKSB7CiAgX3JlbmV3ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGp3dCkgewogICAgdmFyIHJlcywgYm9keTsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgcmV0dXJuIGZldGNoKCIiLmNvbmNhdChhcGlTZXJ2ZXIsICIvYXBpL3JlbmV3IiksIHsKICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnWC1BdXRoJzogand0CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDU7CiAgICAgICAgICAgIHJldHVybiByZXMudGV4dCgpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgYm9keSA9IF9jb250ZXh0My5zZW50OwoKICAgICAgICAgICAgaWYgKCEocmVzLnN0YXR1cyA9PT0gMjAwKSkgewogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBhcnNlVG9rZW4oYm9keSk7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTE7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihib2R5KTsKCiAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMyk7CiAgfSkpOwogIHJldHVybiBfcmVuZXcuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHNpZ251cChfeDQsIF94NSkgewogIHJldHVybiBfc2lnbnVwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIF9zaWdudXAoKSB7CiAgX3NpZ251cCA9IF9hc3luY1RvR2VuZXJhdG9yKAogIC8qI19fUFVSRV9fKi8KICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCh1c2VybmFtZSwgcGFzc3dvcmQpIHsKICAgIHZhciBkYXRhLCByZXM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSwKICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICByZXR1cm4gZmV0Y2goIiIuY29uY2F0KGFwaVNlcnZlciwgIi9hcGkvc2lnbnVwIiksIHsKICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJlcyA9IF9jb250ZXh0NC5zZW50OwoKICAgICAgICAgICAgaWYgKCEocmVzLnN0YXR1cyAhPT0gMjAwKSkgewogICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5zdGF0dXMpOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTQpOwogIH0pKTsKICByZXR1cm4gX3NpZ251cC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpleHBvcnQgZnVuY3Rpb24gbG9nb3V0KCkgewogIHN0b3JlLmNvbW1pdCgnc2V0SldUJywgJycpOwogIHN0b3JlLmNvbW1pdCgnc2V0VXNlcicsIG51bGwpOwogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdqd3QnLCBudWxsKTsKICByb3V0ZXIucHVzaCh7CiAgICBwYXRoOiAnL2xvZ2luJwogIH0pOwp9"},{"version":3,"sources":["/home/lq/ifb/src/eshop/frontend/src/utils/auth.js"],"names":["store","router","Base64","apiServer","parseToken","token","parts","split","length","Error","data","JSON","parse","decode","Math","round","Date","getTime","exp","console","log","localStorage","setItem","commit","user","validateLogin","getItem","renew","warn","login","email","password","fetch","method","headers","body","stringify","res","json","status","retCode","jwt","text","signup","username","logout","push","path"],"mappings":"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","sourcesContent":["import store from '@/store'\nimport router from '@/router'\nimport { Base64 } from 'js-base64'\n//import { baseURL } from '@/utils/constants'\nimport { apiServer } from './constants'\n\n\nexport function parseToken(token) {\n\n  if (!token) {\n    return\n  }\n  const parts = token.split('.')\n\n  if (parts.length !== 3) {\n    throw new Error('token malformed')\n  }\n\n  const data = JSON.parse(Base64.decode(parts[1]))\n\n  if (Math.round(new Date().getTime() / 1000) > data.exp) {\n    throw new Error('token expired')\n  }\n  console.log(data);\n\n  localStorage.setItem('jwt', token)\n  store.commit('setJWT', token)\n  store.commit('setUser', data.user)\n}\n\nexport async function validateLogin() {\n  try {\n    if (localStorage.getItem('jwt')) {\n      await renew(localStorage.getItem('jwt'))\n    }\n  } catch (_) {\n    console.warn('Invalid JWT token in storage') // eslint-disable-line\n  }\n}\n\nexport async function login(email, password) {\n  if (!email) {\n    return\n  }\n  const res = await fetch(`${apiServer}/api/user/login`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ \"email\": email, \"password\": password })\n  })\n\n  const body = await res.json();\n  // console.log(body)\n  if (res.status === 200 && body.retCode >= 0) {\n    /* localStorage.setItem('jwt', body.data)\n    store.commit('setJWT', body.data)\n    store.commit('setUser', user) */\n    parseToken(body.data);\n  } else {\n    throw new Error(body)\n  }\n}\n\nexport async function renew(jwt) {\n  const res = await fetch(`${apiServer}/api/renew`, {\n    method: 'POST',\n    headers: {\n      'X-Auth': jwt,\n    }\n  })\n\n  const body = await res.text()\n\n  if (res.status === 200) {\n    parseToken(body)\n  } else {\n    throw new Error(body)\n  }\n}\n\nexport async function signup(username, password) {\n  const data = { username, password }\n\n  const res = await fetch(`${apiServer}/api/signup`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(data)\n  })\n\n  if (res.status !== 200) {\n    throw new Error(res.status)\n  }\n}\n\nexport function logout() {\n  store.commit('setJWT', '')\n  store.commit('setUser', null)\n  localStorage.setItem('jwt', null)\n  router.push({ path: '/login' })\n}\n"]}]}